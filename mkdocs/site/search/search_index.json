{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Cybershield Solutions \u2014 Diag Agent","text":"<p>Automatitzaci\u00f3 d'Auditories i Pla de Millora</p>"},{"location":"#benvingut-a-la-documentacio","title":"Benvingut a la Documentaci\u00f3","text":"<p>Aquesta documentaci\u00f3 cobreix el projecte Diag Agent de Cybershield Solutions, una eina professional d'auditoria de seguretat per a sistemes Linux.</p>"},{"location":"#caracteristiques-principals","title":"Caracter\u00edstiques Principals","text":"<ul> <li>Auditoria Automatitzada: Escaneig de vulnerabilitats, ports i configuracions SSH en minuts</li> <li>Pentest Agent: Nou m\u00f2dul d'auditoria web professional (SQLi, XSS, LFI)</li> <li>SOC Dashboard: Monitoratge en temps real de CPU, mem\u00f2ria, xarxa i events de seguretat</li> <li>Informes Professionals: Generaci\u00f3 de PDF amb signatura digital i enviament via Telegram</li> <li>API REST: Integraci\u00f3 segura amb sistemes externs</li> </ul>"},{"location":"#continguts","title":"Continguts","text":"Secci\u00f3 Descripci\u00f3 Context del Projecte Presentaci\u00f3 de Cybershield Solutions i objectius Metodologia SCRUM Organitzaci\u00f3 del projecte amb metodologia \u00e0gil Empresa Auditada Institut de l'Ebre i la seva infraestructura Identificaci\u00f3 d'Actius An\u00e0lisi dels actius i amenaces Valoraci\u00f3 del Risc Taula de riscos i mesures preventives Arquitectura Disseny t\u00e8cnic del Diag Agent M\u00f2duls de Seguretat Trivy, Nmap, SSH-Audit, Enum4Linux Pentest Agent Nou motor d'auditoria web (SQLi, XSS, etc.) SOC Dashboard Centre d'Operacions de Seguretat API REST Documentaci\u00f3 dels endpoints Integracions Telegram i notificacions Hardening Seguretat i tancament d'amenaces Requisits Depend\u00e8ncies del sistema Instal\u00b7laci\u00f3 Guia d'instal\u00b7laci\u00f3 completa Configuraci\u00f3 Par\u00e0metres i systemd Website Documentaci\u00f3 de la landing page Manual d'Usuari Com utilitzar l'eina Signatura Digital Certificats i signatura PDF Conclusions Conclusions i futures millores"},{"location":"#comencar-rapidament","title":"Comen\u00e7ar R\u00e0pidament","text":"<pre><code># 1. Copiar fitxers al servidor\nscp setup_diag.sh diag_agent_single.py user@server:/opt/diag/\n\n# 2. Donar permisos\nsudo chmod +x setup_diag.sh\n\n# 3. Executar instal\u00b7laci\u00f3\nsudo ./setup_diag.sh\n\n# 4. Accedir a la interf\u00edcie\nfirefox http://192.168.1.100:8080\n</code></pre>"},{"location":"#eines-integrades","title":"Eines Integrades","text":"Eina Funci\u00f3 Trivy Escaneig de vulnerabilitats (CVEs) Nmap Escaneig de ports i serveis SSH-Audit Auditoria de configuraci\u00f3 SSH Enum4Linux Enumeraci\u00f3 de serveis SMB WeasyPrint Generaci\u00f3 d'informes PDF PyHanko Signatura digital de documents"},{"location":"#fitxers-principals","title":"Fitxers Principals","text":"Fitxer L\u00ednies Descripci\u00f3 <code>diag_agent_single.py</code> ~7.320 Agent principal amb interf\u00edcie web <code>pentest_agent.py</code> ~3.282 Nou motor de pentesting web <code>setup_diag.sh</code> 137 Script d'instal\u00b7laci\u00f3 automatitzat <code>Website/index.html</code> 1280 Landing page corporativa <code>Website/custom.css</code> 1405 Estils de la web <code>Website/custom.js</code> - Interactivitat i animacions <p>Projecte Acad\u00e8mic</p> <p>Aquest projecte forma part del cicle formatiu ASIX amb perfil de Ciberseguretat a l'Institut de l'Ebre.</p> <p>Autor: Vitaliy Domin Versi\u00f3: 2026 Professional Edition Empresa: Cybershield Solutions, S.L.</p>"},{"location":"agent/actius/","title":"Identificaci\u00f3 d'Actius","text":"<p>L'an\u00e0lisi de riscos s'ha realitzat per identificar i valorar els possibles incidents que podrien afectar la infraestructura tecnol\u00f2gica de l'Institut de l'Ebre, amb l'objectiu de determinar el seu impacte i la probabilitat d'ocurr\u00e8ncia. Aquesta avaluaci\u00f3 s'ha basat en la metodologia de l'INCIBE (Institut Nacional de Ciberseguretat d'Espanya), adaptada al context del centre i al seu entorn Linux.</p>"},{"location":"agent/actius/#actius-principals","title":"Actius Principals","text":"<p>Els principals actius analitzats durant l'auditoria han estat:</p> Actiu Descripci\u00f3 Servidors Ubuntu Dos servidors en alta disponibilitat que allotgen els serveis cr\u00edtics Sistemes d'autenticaci\u00f3 LDAP i gesti\u00f3 d'usuaris Bases de dades Sistemes acad\u00e8mics i de gesti\u00f3 interna Xarxa interna Segmentada per VLANs (administraci\u00f3, professorat, alumnat, convidats) Equips d'usuari final Punts d'acc\u00e9s de la xarxa"},{"location":"agent/actius/#amenaces-identificades","title":"Amenaces identificades","text":"<p>Durant l'avaluaci\u00f3 s'han detectat o considerat les seg\u00fcents amenaces potencials:</p> <p>Amenaces Cr\u00edtiques</p> <ul> <li>Vulnerabilitats de programari no actualitzat en servidors o paquets del sistema.</li> <li>Configuracions insegures de serveis de xarxa (SSH, web, bases de dades).</li> <li>Errors humans en la gesti\u00f3 de permisos o credencials.</li> </ul> <p>Amenaces Moderades</p> <ul> <li>Acc\u00e9s no autoritzat des de xarxes internes o dispositius compromesos.</li> <li>Manca de pol\u00edtiques de c\u00f2pia de seguretat o restauraci\u00f3 deficient.</li> <li>Sobrec\u00e0rrega o fallada en la replicaci\u00f3 HA, que podria interrompre serveis essencials.</li> </ul>"},{"location":"agent/api/","title":"API REST","text":"<p>El Diag Agent exposa una API RESTful per integrar-se amb altres sistemes.</p>"},{"location":"agent/api/#autenticacio-i-seguretat","title":"Autenticaci\u00f3 i Seguretat","text":""},{"location":"agent/api/#restriccio-per-ip","title":"Restricci\u00f3 per IP","text":"<pre><code>ALLOWED_NETWORKS = []  # Configurat via --allow-from\n\n@app.before_request\ndef restrict_client_ip():\n    \"\"\"Bloqueja peticions de IPs no autoritzades.\"\"\"\n    client_ip = request.remote_addr\n\n    # Sempre permetre localhost\n    if client_ip in [\"127.0.0.1\", \"::1\"]:\n        return\n\n    # Verificar contra xarxes permeses\n    from ipaddress import ip_address, ip_network\n    client = ip_address(client_ip)\n\n    for network_str in ALLOWED_NETWORKS:\n        if client in ip_network(network_str):\n            return\n\n    abort(403)\n</code></pre>"},{"location":"agent/api/#configuracio-inicial","title":"Configuraci\u00f3 Inicial","text":"<pre><code># Permetre nom\u00e9s xarxa local\nsudo ./setup_diag.sh 192.168.1.100 192.168.1.0/24 8080\n#                     ^IP servidor  ^Xarxa permesa  ^Port\n</code></pre>"},{"location":"agent/api/#endpoints-disponibles","title":"Endpoints Disponibles","text":""},{"location":"agent/api/#estat-del-sistema","title":"Estat del Sistema","text":""},{"location":"agent/api/#get-apistatus","title":"<code>GET /api/status</code>","text":"<p>Retorna l'estat general del sistema.</p> <p>Resposta: <pre><code>{\n  \"timestamp\": \"2025-01-15T10:30:00Z\",\n  \"hostname\": \"ubuntu-server\",\n  \"vulns\": {\n    \"critical\": 2,\n    \"high\": 5,\n    \"medium\": 12,\n    \"low\": 8\n  },\n  \"cpu\": 45.2,\n  \"memory\": 62.1,\n  \"disk\": 55.0,\n  \"ssh_fails\": 15,\n  \"packages_upgradable\": 23,\n  \"services_running\": 45,\n  \"processes_suspicious\": 0\n}\n</code></pre></p> <p>Exemple: <pre><code>curl http://localhost:8080/api/status | jq\n</code></pre></p>"},{"location":"agent/api/#escaneig-de-vulnerabilitats","title":"Escaneig de Vulnerabilitats","text":""},{"location":"agent/api/#post-apirun_trivy_filtered","title":"<code>POST /api/run_trivy_filtered</code>","text":"<p>Executa un escaneig Trivy amb filtres opcionals.</p> <p>Request Body: <pre><code>{\n  \"severity\": [\"CRITICAL\", \"HIGH\"],\n  \"limit\": 100\n}\n</code></pre></p> <p>Resposta: <pre><code>{\n  \"success\": true,\n  \"scan_time\": \"2025-01-15T10:35:00Z\",\n  \"duration_seconds\": 45.2,\n  \"total_vulns\": 7,\n  \"vulnerabilities\": [\n    {\n      \"id\": \"CVE-2023-12345\",\n      \"package\": \"openssl\",\n      \"severity\": \"CRITICAL\",\n      \"installed_version\": \"1.1.1f\",\n      \"fixed_version\": \"1.1.1g\",\n      \"title\": \"Buffer overflow vulnerability\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"agent/api/#post-apivulnsrefresh","title":"<code>POST /api/vulns/refresh</code>","text":"<p>For\u00e7a un refresc manual de la cach\u00e9 de Trivy. \u00datil quan s'han actualitzat paquets o es necessiten resultats actualitzats immediatament.</p> <p>Request Body: <pre><code>{}\n</code></pre> (Cos buit, no cal par\u00e0metres)</p> <p>Resposta: <pre><code>{\n  \"success\": true,\n  \"message\": \"Cache refreshed\"\n}\n</code></pre></p> <p>Exemple: <pre><code>curl -X POST http://localhost:8080/api/vulns/refresh\n</code></pre></p> <p>Cach\u00e9 de Trivy</p> <p>Des de la versi\u00f3 2026, el Diag Agent implementa un sistema de cach\u00e9 global per a Trivy que redueix el temps de resposta de 30+ segons a instant despr\u00e9s del primer escaneig. Aquest endpoint permet for\u00e7ar un refresc manual de la cach\u00e9.</p>"},{"location":"agent/api/#pentesting-web-pentest-agent","title":"Pentesting Web (Pentest Agent)","text":""},{"location":"agent/api/#post-apipentestrun","title":"<code>POST /api/pentest/run</code>","text":"<p>Inicia un escaneig de vulnerabilitats web en segon pla.</p> <p>Request Body: <pre><code>{\n  \"target\": \"http://example.com\",\n  \"threads\": 5,\n  \"sqli\": true,\n  \"xss\": true,\n  \"max_requests\": 500\n}\n</code></pre></p>"},{"location":"agent/api/#get-apipenteststatusscan_id","title":"<code>GET /api/pentest/status/&lt;scan_id&gt;</code>","text":"<p>Consulta el progr\u00e9s en temps real (URLs, peticions, troballes).</p>"},{"location":"agent/api/#get-apipentestresultsscan_id","title":"<code>GET /api/pentest/results/&lt;scan_id&gt;</code>","text":"<p>Obt\u00e9 el detall complet de les vulnerabilitats detectades.</p>"},{"location":"agent/api/#integracions-i-reports","title":"Integracions i Reports","text":""},{"location":"agent/api/#get-pentestpdfscan_id","title":"<code>GET /pentest/pdf/&lt;scan_id&gt;</code>","text":"<p>Genera i descarrega l'informe d'auditoria web en PDF signat.</p>"},{"location":"agent/api/#post-apipentesttelegramscan_id","title":"<code>POST /api/pentest/telegram/&lt;scan_id&gt;</code>","text":"<p>Envia l'informe PDF directament a un Chat ID de Telegram.</p> <p>Request Body: <pre><code>{\n  \"chat_id\": \"123456789\"\n}\n</code></pre></p>"},{"location":"agent/api/#codis-de-resposta","title":"Codis de Resposta","text":"Codi Significat <code>200</code> Operaci\u00f3 exitosa <code>400</code> Petici\u00f3 malformada o par\u00e0metres inv\u00e0lids <code>403</code> IP no autoritzada <code>404</code> Endpoint no trobat <code>500</code> Error intern del servidor <code>504</code> Timeout d'operaci\u00f3"},{"location":"agent/api/#exemples-dintegracio","title":"Exemples d'Integraci\u00f3","text":""},{"location":"agent/api/#python","title":"Python","text":"<pre><code>import requests\n\nBASE_URL = \"http://192.168.1.100:8080\"\n\n# Obtenir estat\nresponse = requests.get(f\"{BASE_URL}/api/status\")\nstatus = response.json()\nprint(f\"CPU: {status['cpu']}%\")\n\n# Escaneig Nmap\nscan = requests.post(\n    f\"{BASE_URL}/api/nmap_scan\",\n    json={\"target\": \"192.168.1.1\", \"extra_args\": \"-sV\"}\n)\nprint(scan.json())\n</code></pre>"},{"location":"agent/api/#bashcurl","title":"Bash/cURL","text":"<pre><code>#!/bin/bash\nBASE=\"http://192.168.1.100:8080\"\n\n# Estat del sistema\ncurl -s \"$BASE/api/status\" | jq '.cpu, .memory, .disk'\n\n# Escaneig de vulnerabilitats\ncurl -s -X POST \"$BASE/api/run_trivy_filtered\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"severity\": [\"CRITICAL\"]}' | jq '.total_vulns'\n</code></pre>"},{"location":"agent/api/#javascript","title":"JavaScript","text":"<pre><code>const BASE_URL = 'http://192.168.1.100:8080';\n\n// Polling d'estat cada 5 segons\nsetInterval(async () =&gt; {\n  const response = await fetch(`${BASE_URL}/api/status`);\n  const data = await response.json();\n\n  document.getElementById('cpu').textContent = `${data.cpu}%`;\n  document.getElementById('memory').textContent = `${data.memory}%`;\n\n  if (data.ssh_fails &gt; 10) {\n    alert('\u26a0\ufe0f Detectades m\u00faltiples fallades SSH!');\n  }\n}, 5000);\n</code></pre> <p>Rate Limiting</p> <p>Actualment no hi ha rate limiting implementat. Per a entorns de producci\u00f3, es recomana utilitzar un reverse proxy (nginx) amb configuraci\u00f3 de l\u00edmits.</p>"},{"location":"agent/arquitectura/","title":"Arquitectura del Diag Agent","text":"<p>El fitxer principal <code>diag_agent_single.py</code> (~6.715 l\u00ednies) i el m\u00f2dul especialitzat <code>pentest_agent.py</code> (~3.141 l\u00ednies) formen una soluci\u00f3 monol\u00edtica i modular alhora per facilitar el desplegament en entorns auditats.</p>"},{"location":"agent/arquitectura/#diagrama-darquitectura","title":"Diagrama d'Arquitectura","text":"<pre><code>flowchart TB\n    subgraph Frontend[\"Frontend\"]\n        UI[\"Interf\u00edcie Web&lt;br/&gt;Bootstrap 5\"]\n        Charts[\"Gr\u00e0fiques&lt;br/&gt;Chart.js\"]\n    end\n\n    subgraph Backend[\"Backend\"]\n        Flask[\"Flask Server&lt;br/&gt;Python 3\"]\n        API[\"API REST&lt;br/&gt;JSON\"]\n    end\n\n    subgraph Parsers[\"Parsers\"]\n        SSH[\"SSHAuditParser\"]\n        Nmap[\"NmapParser\"]\n        Enum[\"Enum4Linux\"]\n    end\n\n    subgraph Tools[\"Eines Externes\"]\n        Trivy[\"Trivy Scanner\"]\n        NmapTool[\"Nmap\"]\n        SSHAudit[\"ssh-audit\"]\n        E4L[\"enum4linux-ng\"]\n        PTAgent[\"pentest_agent.py\"]\n        Scapy[\"Scapy Engine\"]\n    end\n\n    subgraph Output[\"Output\"]\n        PDF[\"WeasyPrint&lt;br/&gt;PDF Reports\"]\n        Telegram[\"Telegram Bot&lt;br/&gt;Notifications\"]\n        CSV[\"CSV Export\"]\n        Sign[\"Signatura Digital&lt;br/&gt;PyHanko\"]\n    end\n\n    UI --&gt; Flask\n    Charts --&gt; Flask\n    Flask --&gt; API\n    Flask --&gt; Parsers\n    Parsers --&gt; Tools\n    Flask --&gt; Output</code></pre>"},{"location":"agent/arquitectura/#components-principals","title":"Components Principals","text":""},{"location":"agent/arquitectura/#backend-python-3-flask","title":"Backend (Python 3 + Flask)","text":"<pre><code>app = Flask(__name__)\n\n# Configuraci\u00f3 globals\nNMAP_BIN = shutil.which(\"nmap\")\nNMAP_TIMEOUT = 120\nNMAP_MAX_CHARS = 250_000\n</code></pre> Responsabilitat Implementaci\u00f3 Gesti\u00f3 de rutes HTTP <code>@app.route()</code> decorators Execuci\u00f3 de comandes <code>subprocess.run()</code> amb timeouts Processament de dades Estructures <code>dataclass</code> Restricci\u00f3 d'acc\u00e9s <code>ALLOWED_NETWORKS</code> whitelist"},{"location":"agent/arquitectura/#frontend-html-javascript","title":"Frontend (HTML + JavaScript)","text":"<p>El frontend est\u00e0 integrat dins el mateix fitxer Python utilitzant <code>render_template_string</code>:</p> <pre><code>BASE_HTML = \"\"\"\n&lt;!doctype html&gt;\n&lt;html lang=\"en\" data-theme=\"dark\"&gt;\n&lt;head&gt;\n  &lt;meta charset=\"utf-8\"&gt;\n  &lt;link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\"&gt;\n  &lt;link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css\" rel=\"stylesheet\"&gt;\n  &lt;link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap\" rel=\"stylesheet\"&gt;\n  ...\n&lt;/head&gt;\n\"\"\"\n</code></pre> <p>Caracter\u00edstiques: - Mode fosc per defecte - Disseny responsive - Tema professional \"Cybersecurity\"</p>"},{"location":"agent/arquitectura/#parsers-professionals","title":"Parsers Professionals","text":"<p>Cada eina externa t\u00e9 el seu propi parser estructurat:</p> SSHAuditParserNmapParser <pre><code>@dataclass\nclass SSHAlgorithm:\n    name: str\n    key_size: str = \"\"\n    security_level: str = \"unknown\"\n    notes: List[str] = field(default_factory=list)\n\n@dataclass\nclass SSHAuditReport:\n    banner: str = \"\"\n    software: str = \"\"\n    kex_secure: List[SSHAlgorithm]\n    kex_weak: List[SSHAlgorithm]\n    critical_issues: List[str]\n    hardening_actions: List[str]\n</code></pre> <pre><code>@dataclass\nclass NmapPort:\n    port: int\n    protocol: str = \"tcp\"\n    state: str = \"\"\n    service: str = \"\"\n    version: str = \"\"\n    security_level: str = \"unknown\"\n\n@dataclass\nclass NmapHost:\n    ip: str\n    hostname: str = \"\"\n    ports: List[NmapPort]\n</code></pre>"},{"location":"agent/arquitectura/#seguretat-integrada","title":"Seguretat Integrada","text":""},{"location":"agent/arquitectura/#validacio-darguments-nmap","title":"Validaci\u00f3 d'Arguments Nmap","text":"<pre><code># Flags segurs permesos\nSINGLE_TOKEN_WHITELIST = {\"-p-\", \"-Pn\", \"-sV\", \"-v\", \"-vv\", \"-A\"}\nT_TUNING_RE = re.compile(r\"^-T[0-5]$\")\n\ndef validate_nmap_extra_args(tokens):\n    \"\"\"Rejects --script* and shell metachars\"\"\"\n    for t in tokens:\n        if \"--script\" in t.lower():\n            return None, \"Scripts not allowed\"\n        if re.search(r'[;&amp;|`$(){}]', t):\n            return None, \"Shell metachar detected\"\n</code></pre>"},{"location":"agent/arquitectura/#restriccio-de-xarxa","title":"Restricci\u00f3 de Xarxa","text":"<pre><code>ALLOWED_NETWORKS = []  # Per defecte, nom\u00e9s localhost\n\n@app.before_request\ndef restrict_client_ip():\n    if not is_client_allowed(request.remote_addr):\n        abort(403)\n</code></pre>"},{"location":"agent/arquitectura/#flux-de-dades","title":"Flux de Dades","text":"<pre><code>sequenceDiagram\n    participant User as Usuari\n    participant Web as Web UI\n    participant Flask as Flask\n    participant Tool as Eina\n    participant Parser as Parser\n\n    User-&gt;&gt;Web: Clica \"Run Scan\"\n    Web-&gt;&gt;Flask: POST /api/scan\n    Flask-&gt;&gt;Tool: subprocess.run()\n    Tool--&gt;&gt;Flask: stdout/stderr\n    Flask-&gt;&gt;Parser: parse(raw_output)\n    Parser--&gt;&gt;Flask: structured_data\n    Flask--&gt;&gt;Web: JSON response\n    Web--&gt;&gt;User: Mostra resultats</code></pre>"},{"location":"agent/arquitectura/#estructura-del-codi","title":"Estructura del Codi","text":"L\u00ednies Descripci\u00f3 1-38 Imports i configuraci\u00f3 (ara inclou Scapy) 39-623 SSHAuditParser 624-1053 NmapParser 1054-1150 Seguretat (Hardening) i Helpers 1151-1800 UI HTML/CSS/JS (Protecci\u00f3 XSS) 1801-1907 SOC Dashboard Metrics 1908-2022 Network IDS (Classe NetworkMonitor) 2023-2800 Pentest Wrapper i API 2801-7100+ Report generation, Telegram, PDF signing i Cach\u00e9 de Trivy"},{"location":"agent/arquitectura/#sistema-de-cache-de-trivy","title":"Sistema de Cach\u00e9 de Trivy","text":"<p>Un dels problemes de rendiment m\u00e9s significatius del Diag Agent era el temps d'execuci\u00f3 de Trivy. Cada escaneig de vulnerabilitats trigava 30+ segons, la qual cosa impactava greument la usabilitat.</p>"},{"location":"agent/arquitectura/#problema","title":"Problema","text":"<pre><code>[Usuari clica \"Vulnerabilities\"] \u2192 30 segons d'espera \u2192 Resultats\n[Usuari actualitza la p\u00e0gina]    \u2192 30 segons d'espera \u2192 Mateixos resultats\n</code></pre>"},{"location":"agent/arquitectura/#solucio-cache-global-amb-worker-de-fons","title":"Soluci\u00f3: Cach\u00e9 Global amb Worker de Fons","text":"<p>Arquitectura implementada:</p> <pre><code>graph TB\n    A[Inici Servidor] --&gt; B[Crear TRIVY_CACHE]\n    B --&gt; C[Iniciar refresh_trivy_cache thread]\n    C --&gt; D[Primer escaneig: 30s]\n    D --&gt; E[Guarda a TRIVY_CACHE]\n    E --&gt; F{Usuari demana /ui_vulns}\n    F --&gt; G[collect_trivy verifica cach\u00e9]\n    G --&gt;|Hit| H[Retorn instant 0.001s]\n    G --&gt;|Miss| I[Executa Trivy: 30s]\n    I --&gt; E\n    E --&gt; J[Cada hora: refresc autom\u00e0tic]\n    J --&gt; D</code></pre>"},{"location":"agent/arquitectura/#implementacio","title":"Implementaci\u00f3","text":"<p>Variables globals (diag_agent_single.py, l\u00ednies ~150-170):</p> <pre><code># Global Trivy cache\nTRIVY_CACHE = {}          # Dict: {scan_type: result}\nTRIVY_LOCK = threading.Lock()  # Thread-safe protection\n\ndef refresh_trivy_cache():\n    \"\"\"Background worker: refreshes Trivy cache every hour.\"\"\"\n    while True:\n        with TRIVY_LOCK:\n            TRIVY_CACHE['os'] = collect_trivy('os', force_refresh=True)\n            TRIVY_CACHE['python'] = collect_trivy('python', force_refresh=True)\n        time.sleep(3600)  # 1 hora\n</code></pre> <p>Funci\u00f3 de recollida amb cach\u00e9 (~l\u00ednies 200-250):</p> <pre><code>def collect_trivy(scan_type='os', force_refresh=False):\n    \"\"\"Collect Trivy scan results with caching support.\"\"\"\n\n    # 1. Check cache first (if not forcing refresh)\n    if not force_refresh:\n        with TRIVY_LOCK:\n            if scan_type in TRIVY_CACHE:\n                return TRIVY_CACHE[scan_type]  # INSTANT!\n\n    # 2. Execute Trivy (slow: 30+ seconds)\n    result = subprocess.run(\n        ['trivy', 'fs', '--scanners', 'vuln', ...],\n        capture_output=True,\n        timeout=120\n    )\n\n    # 3. Parse and cache result\n    parsed_data = parse_trivy_output(result.stdout)\n\n    with TRIVY_LOCK:\n        TRIVY_CACHE[scan_type] = parsed_data\n\n    return parsed_data\n</code></pre> <p>Endpoint per a refresc manual:</p> <pre><code>@app.route(\"/api/vulns/refresh\", methods=[\"POST\"])\ndef api_vulns_refresh():\n    \"\"\"Force Trivy cache refresh.\"\"\"\n    with TRIVY_LOCK:\n        TRIVY_CACHE.clear()\n\n    # Trigger immediate refresh\n    collect_trivy('os', force_refresh=True)\n    collect_trivy('python', force_refresh=True)\n\n    return jsonify({\"success\": True, \"message\": \"Cache refreshed\"})\n</code></pre>"},{"location":"agent/arquitectura/#beneficis","title":"Beneficis","text":"Escenari Abans Despr\u00e9s Millora Primera c\u00e0rrega 30s 30s - Actualitzar p\u00e0gina 30s 0.001s 99.99% Navegaci\u00f3 entre p\u00e0gines 30s 0.001s 99.99% Refresc manual N/A 30s Sota demanda"},{"location":"agent/arquitectura/#thread-safety","title":"Thread Safety","text":"<p>El sistema fa servir <code>threading.Lock()</code> per evitar race conditions:</p> <ul> <li>Sense Lock: Dos threads podrien escriure a <code>TRIVY_CACHE</code> simult\u00e0niament \u2192 Dades corruptes</li> <li>Amb Lock: Nom\u00e9s un thread pot accedir a <code>TRIVY_CACHE</code> a la vegada \u2192 Segur</li> </ul> <pre><code>with TRIVY_LOCK:  # Bloqueja l'acc\u00e9s\n    TRIVY_CACHE['os'] = result\n# Desbloqueja autom\u00e0ticament en sortir del block\n</code></pre>"},{"location":"agent/arquitectura/#cicle-de-vida","title":"Cicle de Vida","text":"<ol> <li>Inici del servidor: <code>refresh_trivy_cache()</code> s'inicia com a thread <code>daemon</code></li> <li>Primer escaneig: 30 segons (inevitable, Trivy \u00e9s lent)</li> <li>Guardat a cach\u00e9: <code>TRIVY_CACHE['os'] = result</code></li> <li>Seg\u00fcents peticions: Lectura instant de mem\u00f2ria</li> <li>Cada hora: Refresc autom\u00e0tic de fons</li> <li>Manual: Via <code>/api/vulns/refresh</code></li> </ol> <p>Single-File Design</p> <p>El disseny monol\u00edtic permet copiar un sol fitxer <code>.py</code> al servidor i executar-lo directament, sense depend\u00e8ncies de fitxers externs (excepte les eines del sistema).</p>"},{"location":"agent/codi-tecnic/","title":"An\u00e0lisi T\u00e8cnica del Codi","text":"<p>Aquest document proporciona una an\u00e0lisi t\u00e8cnica detallada de les parts m\u00e9s importants del Diag Agent, especialment del m\u00f2dul Pentest. \u00c9s una guia per a professors i avaluadors que vulguin comprendre la l\u00f2gica interna i les decisions de disseny del codi.</p>"},{"location":"agent/codi-tecnic/#estructura-del-projecte","title":"Estructura del Projecte","text":"<pre><code>Diag agent/\n\u251c\u2500\u2500 diag_agent_single.py   (~6.715 l\u00ednies) - Servei web Flask amb SOC Dashboard\n\u251c\u2500\u2500 pentest_agent.py       (~3.141 l\u00ednies) - Motor d'auditoria web\n\u251c\u2500\u2500 diagbot.py            (~3.274 l\u00ednies) - Bot de Telegram\n\u2514\u2500\u2500 setup_diag.sh         ( ~137 l\u00ednies) - Script d'instal\u00b7laci\u00f3\n</code></pre>"},{"location":"agent/codi-tecnic/#classes-principals","title":"Classes Principals","text":""},{"location":"agent/codi-tecnic/#1-pentestagent-pentest_agentpy","title":"1. <code>PentestAgent</code> (pentest_agent.py)","text":"<p>\u00c9s la classe central del m\u00f2dul d'auditoria web. Gestiona tot el proc\u00e9s d'escaneig, des del crawling fins a la generaci\u00f3 d'informes.</p> <p>Atributs clau: <pre><code>class PentestAgent:\n    def __init__(self, base_url, max_threads=10, max_requests=500):\n        self.base_url = base_url\n        self._findings = []           # Llista de descobertes\n        self._visited_urls = set()    # URLs ja visitades (evita duplicats)\n        self._stats = ScanStats()     # Estad\u00edstiques de l'escaneig\n        self._not_found_paths = []    # Camins 404 (separats de findings)\n        self._lock = Lock()           # Thread-safe per a concurr\u00e8ncia\n</code></pre></p> <p>Per qu\u00e8 \u00e9s important el Lock? - El PentestAgent usa <code>ThreadPoolExecutor</code> per fer m\u00faltiples peticions simult\u00e0nies - Sense el <code>Lock</code>, m\u00faltiples threads podrien modificar <code>_findings</code> al mateix temps - Aix\u00f2 causaria race conditions (resultats impredictibles)</p> <p>M\u00e8todes principals:</p> M\u00e8tode L\u00ednies Funci\u00f3 <code>run()</code> ~50 Orquestraci\u00f3 general: Crawl \u2192 Scan \u2192 Report <code>_crawl_recursive()</code> ~100 Descobriment recursiu de rutes i formularis <code>scan_sqli()</code> ~200 Detecci\u00f3 de SQL Injection (time-based, error-based, union-based) <code>scan_xss()</code> ~150 Detecci\u00f3 de Cross-Site Scripting <code>scan_sensitive_files()</code> ~80 Cerca de fitxers exposats (.env, config.php, etc.) <code>_classify_exposure()</code> ~75 Cervell del scanner - Classifica respostes HTTP <code>export_txt()</code> ~50 Generaci\u00f3 d'informes TXT <code>export_html()</code> ~150 Generaci\u00f3 d'informes HTML"},{"location":"agent/codi-tecnic/#2-explanationdatabase-pentest_agentpy-linies-159-206","title":"2. <code>ExplanationDatabase</code> (pentest_agent.py, l\u00ednies 159-206)","text":"<p>Aquesta classe \u00e9s l'aportaci\u00f3 m\u00e9s destacada a nivell de professionalitat d'informes.</p> <p>Concepte: Els esc\u00e0ners autom\u00e0tics tradicionals nom\u00e9s diuen \"SQL Injection detectat\". Aix\u00f2 \u00e9s poc \u00fatil per a: - Directius que no entenen de ciberseguretat - Professors que avaluen el projecte - Auditors que necessiten justificar els seus descobriments</p> <p>Soluci\u00f3: Cada tipus de vulnerabilitat t\u00e9 una explicaci\u00f3 d'1-2 par\u00e0grafs que: 1. Descriu qu\u00e8 \u00e9s la vulnerabilitat 2. Explica com es podria explotar 3. Detalla l'impacte potencial</p> <p>Codi: <pre><code>class ExplanationDatabase:\n    \"\"\"Provides human-readable, auditor-friendly explanations for findings.\"\"\"\n\n    EXPLANATIONS = {\n        \"SQL Injection\": {\n            \"text\": \"The application appears to be vulnerable to SQL Injection...\",\n            \"impact\": \"Critical data loss or unauthorized access.\"\n        },\n        \"Missing Security Headers\": {\n            \"text\": \"The application response does not include one or more recommended HTTP security headers...\",\n            \"impact\": \"Reduced defense-in-depth against client-side attacks.\"\n        }\n        # ... 9 tipus diferents de vulnerabilitats\n    }\n\n    @classmethod\n    def get_explanation(cls, vuln_type: str) -&gt; str:\n        entry = cls.EXPLANATIONS.get(vuln_type)\n        if entry:\n            return f\"{entry['text']} Impact: {entry['impact']}\"\n        return \"Automated finding requiring manual verification.\"\n</code></pre></p> <p>Integraci\u00f3 amb informes PDF: A <code>diag_agent_single.py</code>, l\u00ednies 6395-6396: <pre><code>vuln_type = getattr(f, 'vuln_type', 'Unknown')\nexplanation = ExplanationDatabase.get_explanation(vuln_type)\n</code></pre></p> <p>Despr\u00e9s s'insereix a la fila de detalls del PDF (l\u00ednia 6413-6415).</p>"},{"location":"agent/codi-tecnic/#3-findingstatus-enum-pentest_agentpy-linies-148-156","title":"3. <code>FindingStatus</code> Enum (pentest_agent.py, l\u00ednies 148-156)","text":"<p>Aquest enum \u00e9s clau per evitar falsos positius.</p> <p>Problema anterior: - Un esc\u00e0ner trobava 133 \"vulnerabilitats\" - 89 eren 404 Not Found (el fitxer ni existeix!) - 30 eren 200 OK per\u00f2 sense contingut sensible real - Nom\u00e9s 4-5 eren vulnerabilitats reals</p> <p>Soluci\u00f3: <pre><code>class FindingStatus(Enum):\n    CONFIRMED = \"CONFIRMED\"               # Prova verificada (ex: secrets trobats)\n    ENUMERATED = \"ENUMERATED\"             # Observat per\u00f2 no confirmat\n    ACCESS_CONTROLLED = \"ACCESS_CONTROLLED\" # 403/401 - Protegit correctament\n    REDIRECTED = \"REDIRECTED\"             # 301/302 - Redirecci\u00f3\n    INFORMATIONAL = \"INFORMATIONAL\"       # P\u00fablic (robots.txt)\n    NOT_FOUND = \"NOT_FOUND\"              # 404 - No existeix\n    NOT_EXPOSED = \"NOT_EXPOSED\"          # 200 OK per\u00f2 contingut gen\u00e8ric\n</code></pre></p> <p>Com es fa servir: Cada vegada que el scanner proba un fitxer sensible, crida <code>_classify_exposure()</code> que retorna un <code>FindingStatus</code>. Nom\u00e9s els estats <code>CONFIRMED</code> i <code>ENUMERATED</code> es compten com a vulnerabilitats reals.</p>"},{"location":"agent/codi-tecnic/#4-networkmonitor-diag_agent_singlepy-linies-1916-2025","title":"4. <code>NetworkMonitor</code> (diag_agent_single.py, l\u00ednies 1916-2025)","text":"<p>Aquest m\u00f2dul \u00e9s el responsable del Advanced Traffic Analytics, implementant una inspecci\u00f3 profunda de paquets (DPI).</p> <p>Atributs i L\u00f2gica: <pre><code>class NetworkMonitor:\n    def __init__(self):\n        self.alerts = deque(maxlen=500)     # Buffer d'alertes\n        self.packets = deque(maxlen=100)    # Live feed\n        self.ip_stats = defaultdict(dict)    # \u00danica IP Tracker (TCP, UDP, Ports)\n        self.top_talkers = defaultdict(int) # Volum de dades\n\n        # Ports perillosos monitoritzats\n        self.danger_ports = {21: \"FTP\", 23: \"Telnet\", 445: \"SMB/AD\", 3389: \"RDP\"}\n</code></pre></p> <p>M\u00e8todes clau:</p> M\u00e8tode Funci\u00f3 Responsabilitat <code>start()</code> Inici Llan\u00e7a el fil <code>sniffer</code> de Scapy en segon pla. <code>_get_local_ips()</code> Filtre Detecta les IPs de la m\u00e0quina per evitar el \"self-tracking\". <code>_packet_callback(pkt)</code> Processament Analitza cada paquet, ignora tr\u00e0nsit local i calcula hits. <code>_classify_traffic()</code> IA Analyst Motor heur\u00edstic que classifica events ({Port Scan, Brute Force, DoS}). <code>add_alert()</code> Sistema d'Alertes Insereix alertes amb resum d'analista, evid\u00e8ncies i accions."},{"location":"agent/codi-tecnic/#funcions-clau-deep-dive","title":"Funcions Clau - Deep Dive","text":""},{"location":"agent/codi-tecnic/#_classify_exposure-pentest_agentpy-linies-1886-1959","title":"<code>_classify_exposure()</code> (pentest_agent.py, l\u00ednies 1886-1959)","text":"<p>Aquesta \u00e9s la funci\u00f3 m\u00e9s intel\u00b7ligent del scanner. \u00c9s el \"cervell\" que decideix si una resposta HTTP \u00e9s una vulnerabilitat real.</p> <p>Signatura: <pre><code>def _classify_exposure(self, resp: requests.Response, path: str) -&gt; Tuple[FindingStatus, str, str]:\n    \"\"\"\n    Classify a potential sensitive file hit based on response evidence.\n    Returns: (FindingStatus, Severity, BodyFingerprint)\n    \"\"\"\n</code></pre></p> <p>Flux l\u00f2gic:</p> <pre><code>graph TD\n    A[Resposta HTTP] --&gt; B{\u00c9s robots.txt o&lt;br&gt;security.txt?}\n    B --&gt;|S\u00ed| C[INFORMATIONAL + INFO]\n    B --&gt;|No| D{T\u00e9 historial de&lt;br&gt;redireccions?}\n    D --&gt;|S\u00ed| E{Redirigeix a&lt;br&gt;login/home?}\n    E --&gt;|S\u00ed| F[REDIRECTED + INFO]\n    E --&gt;|No| G[REDIRECTED + LOW]\n    D --&gt;|No| H{Codi d'estat?}\n    H --&gt;|403/401| I[ACCESS_CONTROLLED + INFO]\n    H --&gt;|404| J[NOT_FOUND]\n    H --&gt;|200| K{\u00c9s p\u00e0gina SPA&lt;br&gt;o gen\u00e8rica?}\n    K --&gt;|S\u00ed| L[SPA_ROUTED + INFO]\n    K --&gt;|No| M{Cont\u00e9 paraules&lt;br&gt;sensibles?}\n    M --&gt;|S\u00ed| N{\u00c9s fitxer&lt;br&gt;v\u00e0lid?}\n    N --&gt;|S\u00ed| O[CONFIRMED + CRITICAL/HIGH]\n    N --&gt;|No| P[ENUMERATED + MEDIUM]\n    M --&gt;|No| Q{\u00c9s fitxer&lt;br&gt;binari?}\n    Q --&gt;|S\u00ed| O\n    Q --&gt;|No| P</code></pre> <p>Exemple de codi (simplificat): <pre><code>def _classify_exposure(self, resp, path):\n    status_code = resp.status_code\n    body = resp.text or \"\"\n    content_type = resp.headers.get(\"Content-Type\", \"\").lower()\n\n    # 1. Fitxers informatius p\u00fablics\n    if path.endswith((\"robots.txt\", \"security.txt\")):\n        return FindingStatus.INFORMATIONAL, Severity.INFO.value, \"public_info_file\"\n\n    # 2. Redireccions\n    if resp.history:\n        if \"login\" in resp.url.lower():\n            return FindingStatus.REDIRECTED, Severity.INFO.value, \"redirect_to_login\"\n        return FindingStatus.REDIRECTED, Severity.LOW.value, \"redirect\"\n\n    # 3. Access Denied\n    if status_code in (403, 401):\n        return FindingStatus.ACCESS_CONTROLLED, Severity.INFO.value, \"access_denied\"\n\n    # 4. Not Found\n    if status_code == 404:\n        return FindingStatus.NOT_FOUND, Severity.INFO.value, \"not_found\"\n\n    # 5. Detecci\u00f3 SPA (200 OK gen\u00e8ric)\n    if self._is_spa_routing(body):\n        return FindingStatus.SPA_ROUTED, Severity.INFO.value, \"spa_catch_all\"\n\n    # 6. Cerca de contingut sensible\n    sensitive_keywords = [\"password\", \"secret\", \"api_key\", \"private_key\", \"AWS_\"]\n    has_sensitive = any(kw.lower() in body.lower() for kw in sensitive_keywords)\n\n    if has_sensitive and len(body) &gt; 10:\n        return FindingStatus.CONFIRMED, Severity.CRITICAL.value, \"confirmed_secrets\"\n\n    # 7. Fitxers binaris sospitosos (.zip, .sql, .bak)\n    binary_exts = ['.zip', '.tar', '.gz', '.sql', '.db', '.bak']\n    if any(path.endswith(ext) for ext in binary_exts):\n        if \"application/\" in content_type or \"octet-stream\" in content_type:\n            return FindingStatus.CONFIRMED, Severity.HIGH.value, \"confirmed_backup\"\n\n    # 8. Per defecte: enumerat per\u00f2 no confirmat\n    return FindingStatus.ENUMERATED, Severity.INFO.value, \"unverified_hit\"\n</code></pre></p> <p>Per qu\u00e8 \u00e9s important aquesta funci\u00f3? - Abans: 133 \"vulnerabilitats\" (la majoria 404s i false positives) - Despr\u00e9s: 4-5 vulnerabilitats reals confirmades - Guany: Informes professionals i cre\u00efbles</p>"},{"location":"agent/codi-tecnic/#generate_pentest_report_pdf-diag_agent_singlepy-linies-6378-6600","title":"<code>generate_pentest_report_pdf()</code> (diag_agent_single.py, l\u00ednies 6378-6600)","text":"<p>Aquesta funci\u00f3 unifica la generaci\u00f3 de PDFs per a desc\u00e0rrega i Telegram.</p> <p>Problema anterior: - <code>pentest_pdf()</code> generava un PDF per a desc\u00e0rrega - <code>api_pentest_telegram()</code> tenia el seu propi codi HTML diferent - Resultat: Els PDFs podien ser diferents entre desc\u00e0rrega web i Telegram</p> <p>Soluci\u00f3: Una sola funci\u00f3 <code>generate_pentest_report_pdf()</code> que: 1. Rep l'agent i el target com a par\u00e0metres 2. Genera l'HTML complet del PDF 3. Aplica signatura digital (si hi ha certificats) 4. Retorna els bytes del PDF</p> <p>Estructura del codi: <pre><code>def generate_pentest_report_pdf(agent, target):\n    # 1. Importar ExplanationDatabase\n    from pentest_agent import ExplanationDatabase\n\n    # 2. Construir HTML de descobertes (2-row layout)\n    findings_html = \"\"\n    for f in agent._findings:\n        sev = getattr(f, 'severity', 'INFO')\n        vuln_type = getattr(f, 'vuln_type', 'Unknown')\n        explanation = ExplanationDatabase.get_explanation(vuln_type)\n\n        # FILA 1: Metadades\n        findings_html += f\"\"\"\n        &lt;tr class=\"finding-meta\"&gt;\n            &lt;td&gt;&lt;span class=\"{sev_class}\"&gt;{sev}&lt;/span&gt;&lt;/td&gt;\n            &lt;td&gt;{status}&lt;/td&gt;\n            &lt;td&gt;{vuln_type}&lt;/td&gt;\n            &lt;td&gt;{evidence}&lt;/td&gt;\n            &lt;td&gt;{conf}&lt;/td&gt;\n        &lt;/tr&gt;\n        \"\"\"\n\n        # FILA 2: URL + Explicaci\u00f3 (100% amplada)\n        findings_html += f\"\"\"\n        &lt;tr class=\"finding-details\"&gt;\n            &lt;td colspan=\"5\"&gt;\n                &lt;div style=\"color:#2563eb\"&gt;{target_url}&lt;/div&gt;\n                &lt;div style=\"color:#475569\"&gt;{explanation}&lt;/div&gt;\n            &lt;/td&gt;\n        &lt;/tr&gt;\n        \"\"\"\n\n    # 3. Calcular \"Overall Assessment\"\n    if any(f.severity == 'CRITICAL' for f in agent._findings):\n        assessment = \"IMMEDIATE ATTENTION required...\"\n    elif any(f.severity == 'HIGH' for f in agent._findings):\n        assessment = \"Significant risk identified...\"\n    else:\n        assessment = \"Security posture appears robust...\"\n\n    # 4. Construir Appendix (404s)\n    appendix_html = \"\"\n    for path in getattr(agent, '_not_found_paths', []):\n        appendix_html += f\"&lt;li&gt;{path}&lt;/li&gt;\"\n\n    # 5. Generar HTML complet del PDF\n    html_content = f\"\"\"\n    &lt;!DOCTYPE html&gt;\n    &lt;html&gt;\n    &lt;head&gt;...&lt;/head&gt;\n    &lt;body&gt;\n        &lt;h1&gt;Web Vulnerability Scan Report&lt;/h1&gt;\n\n        &lt;!-- Overall Assessment --&gt;\n        &lt;div class=\"summary-box\"&gt;\n            &lt;strong&gt;Overall Security Posture:&lt;/strong&gt;&lt;br&gt;\n            {assessment}\n        &lt;/div&gt;\n\n        &lt;!-- Status Legend --&gt;\n        {status_legend}\n\n        &lt;!-- Findings Table --&gt;\n        &lt;table&gt;\n            &lt;thead&gt;...&lt;/thead&gt;\n            &lt;tbody&gt;{findings_html}&lt;/tbody&gt;\n        &lt;/table&gt;\n\n        &lt;!-- Appendix --&gt;\n        {appendix_html}\n\n        &lt;footer&gt;Cybershield Solutions \u00a9 2025&lt;/footer&gt;\n    &lt;/body&gt;\n    &lt;/html&gt;\n    \"\"\"\n\n    # 6. Generar PDF\n    pdf_bytes = HTML(string=html_content).write_pdf()\n\n    # 7. Signar PDF (si hi ha certificats)\n    if os.path.exists(key_path) and os.path.exists(cert_path):\n        # Codi de signatura amb PyHanko\n        signer = signers.SimpleSigner.load(key_path, cert_path)\n        signed_pdf_bytes = signers.sign_pdf(...)\n        return signed_pdf_bytes\n\n    return pdf_bytes\n</code></pre></p> <p>Avantatges del disseny: - DRY (Don't Repeat Yourself): Un sol lloc per mantenir la l\u00f2gica de generaci\u00f3 - Consist\u00e8ncia: Garanteix que Download i Telegram siguin 100% id\u00e8ntics - Mantenibilitat: Qualsevol millora es reflecteix autom\u00e0ticament en ambd\u00f3s casos</p>"},{"location":"agent/codi-tecnic/#sistema-de-cache-de-trivy","title":"Sistema de Cach\u00e9 de Trivy","text":"<p>El Trivy \u00e9s un esc\u00e0ner de vulnerabilitats que cerca CVEs en imatges Docker i paquets del sistema. El problema \u00e9s que cada escaneig triga 30+ segons.</p>"},{"location":"agent/codi-tecnic/#arquitectura-de-caching","title":"Arquitectura de Caching","text":"<p>Codi clau (diag_agent_single.py, l\u00ednies ~150-300):</p> <pre><code># 1. Variables globals\nTRIVY_CACHE = {}          # Diccionari: {scan_type: result}\nTRIVY_LOCK = threading.Lock()  # Protecci\u00f3 thread-safe\n\n# 2. Worker de fons (s'executa a l'inici del servidor)\ndef refresh_trivy_cache():\n    while True:\n        with TRIVY_LOCK:\n            TRIVY_CACHE['os'] = collect_trivy('os', force_refresh=True)\n            TRIVY_CACHE['python'] = collect_trivy('python', force_refresh=True)\n        time.sleep(3600)  # Cada hora\n\n# 3. Funci\u00f3 de recollida amb cach\u00e9\ndef collect_trivy(scan_type='os', force_refresh=False):\n    if not force_refresh:\n        with TRIVY_LOCK:\n            if scan_type in TRIVY_CACHE:\n                return TRIVY_CACHE[scan_type]  # Retorn instant!\n\n    # Si no hi ha cach\u00e9, executar Trivy (lent)\n    result = subprocess.run(['trivy', 'fs', '--scanners', 'vuln', ...])\n\n    with TRIVY_LOCK:\n        TRIVY_CACHE[scan_type] = result\n\n    return result\n\n# 4. Endpoint per for\u00e7ar refresc manual\n@app.route(\"/api/vulns/refresh\", methods=[\"POST\"])\ndef api_vulns_refresh():\n    TRIVY_CACHE.clear()\n    return jsonify({\"success\": True})\n</code></pre> <p>Flux: <pre><code>[Inici Servidor]\n    \u2193\n[refresh_trivy_cache() thread inicia]\n    \u2193\n[Primer escaneig: 30s] \u2192 TRIVY_CACHE['os'] = result\n    \u2193\n[Usuari demana /ui_vulns]\n    \u2193\n[collect_trivy('os')] \u2192 Troba TRIVY_CACHE['os'] \u2192 Retorn instant (0.001s)\n    \u2193\n[Cada hora: refresc autom\u00e0tic de fons]\n</code></pre></p> <p>Beneficis: - Primera volta: 30 segons (inevitable, Trivy \u00e9s lent) - Seg\u00fcent vegades: Instant (lectura de mem\u00f2ria) - Actualitzaci\u00f3: Autom\u00e0tica cada hora, o manual via <code>/api/vulns/refresh</code></p>"},{"location":"agent/codi-tecnic/#threading-i-concurrencia","title":"Threading i Concurr\u00e8ncia","text":"<p>El Diag Agent fa servir multithreading en diversos llocs:</p>"},{"location":"agent/codi-tecnic/#1-pentestagent-escaneig-parallel","title":"1. PentestAgent - Escaneig Paral\u00b7lel","text":"<pre><code>with ThreadPoolExecutor(max_workers=self.max_threads) as executor:\n    futures = [executor.submit(self._test_sqli, url, param) for url in urls]\n    for future in as_completed(futures):\n        result = future.result()\n</code></pre> <p>Per qu\u00e8? - Sense threading: Provar 100 URLs triga 100 segons (1 per URL) - Amb 10 threads: Provar 100 URLs triga ~10 segons (10 paral\u00b7lels)</p> <p>Risc: Race conditions quan m\u00faltiples threads escriuen a <code>_findings</code> Soluci\u00f3: <code>self._lock.acquire()</code> abans d'afegir discoveries</p>"},{"location":"agent/codi-tecnic/#2-trivy-cache-background-worker","title":"2. Trivy Cache - Background Worker","text":"<pre><code>threading.Thread(target=refresh_trivy_cache, daemon=True).start()\n</code></pre> <p><code>daemon=True</code>: El thread mor autom\u00e0ticament quan el proc\u00e9s principal acaba (no bloqueja shutdown)</p>"},{"location":"agent/codi-tecnic/#estadistiques-de-codi","title":"Estad\u00edstiques de Codi","text":"Component L\u00ednies Classes Funcions Complexitat <code>diag_agent_single.py</code> 7.100+ 6 90+ Molt Alta <code>pentest_agent.py</code> 3.141 7 60+ Molt Alta NetworkMonitor 110 1 6 Alta ExplanationDatabase 50 1 1 Baixa _classify_exposure 75 - 1 Alta generate_pentest_report_pdf 220 - 1 Mitja"},{"location":"agent/codi-tecnic/#conceptes-aplicats-asix","title":"Conceptes Aplicats (ASIX)","text":"<p>Aquest projecte aplica conceptes del cicle formatiu ASIX:</p> M\u00f2dul Concepte Aplicat On Seguretat i Alta Disponibilitat Thread-safe programming, Locks <code>TRIVY_LOCK</code>, <code>self._lock</code> Serveis de Xarxa HTTP Headers, REST APIs Tots els esc\u00e0ners Administraci\u00f3 de Sistemes Subprocess, systemd <code>setup_diag.sh</code>, workers Bases de Dades SQL Injection payloads <code>scan_sqli()</code> Programaci\u00f3 OOP, Enums, Dataclasses Tot el projecte Implantaci\u00f3 d'Aplicacions Web Flask, HTML/CSS, PDF <code>diag_agent_single.py</code>"},{"location":"agent/codi-tecnic/#conclusions-tecniques","title":"Conclusions T\u00e8cniques","text":"<p>Aquest projecte demostra:</p> <ol> <li>Arquitectura modular: Separaci\u00f3 clara entre agent, bot i web</li> <li>Qualitat professional: Informes comparables a consultories reals</li> <li>Optimitzaci\u00f3: Cach\u00e9 de Trivy (30s \u2192 instant)</li> <li>Intel\u00b7lig\u00e8ncia: Classificaci\u00f3 estricta (133 \u2192 4 findings reals)</li> <li>Coneixements avan\u00e7ats: Threading, decoradors, generaci\u00f3 de PDFs, signatura digital</li> </ol> <p>\u00c9s un projecte que va m\u00e9s enll\u00e0 d'un TFG est\u00e0ndard i pot servir com a base per a un portafoli professional.</p>"},{"location":"agent/configuracio/","title":"Configuraci\u00f3","text":""},{"location":"agent/configuracio/#configuracio-basica","title":"Configuraci\u00f3 B\u00e0sica","text":"<p>L'agent s'executa amb privilegis elevats per poder accedir als logs del sistema i realitzar escanejos complets:</p> <pre><code>sudo python3 diag_agent_single.py --host 0.0.0.0 --port 8080\n</code></pre>"},{"location":"agent/configuracio/#parametres-disponibles","title":"Par\u00e0metres Disponibles","text":"Par\u00e0metre Descripci\u00f3 Valor per defecte <code>--host</code> Adre\u00e7a IP d'escolta <code>127.0.0.1</code> <code>--port</code> Port d'escolta <code>8080</code>"},{"location":"agent/configuracio/#acces-a-la-interficie","title":"Acc\u00e9s a la Interf\u00edcie","text":"<p>Un cop iniciat, l'auditor pot accedir a la interf\u00edcie web mitjan\u00e7ant:</p> <ul> <li>Acc\u00e9s local: <code>http://127.0.0.1:8080</code></li> <li>Acc\u00e9s remot: <code>http://&lt;IP_DEL_SERVIDOR&gt;:8080</code></li> </ul> <p>Seguretat</p> <p>Quan s'exposa l'agent a la xarxa (<code>--host 0.0.0.0</code>), assegureu-vos que el port 8080 estigui protegit per un firewall o nom\u00e9s accessible des d'IPs autoritzades.</p>"},{"location":"agent/configuracio/#servei-systemd","title":"Servei Systemd","text":"<p>L'script <code>setup_diag.sh</code> crea autom\u00e0ticament un servei systemd anomenat <code>diag-agent.service</code> que permet:</p> <ul> <li>Execuci\u00f3 autom\u00e0tica en iniciar el servidor</li> <li>Reinici autom\u00e0tic en cas de fallada</li> <li>Gesti\u00f3 estandarditzada amb <code>systemctl</code></li> </ul>"},{"location":"agent/configuracio/#comandes-de-gestio","title":"Comandes de Gesti\u00f3","text":"<pre><code># Iniciar el servei\nsudo systemctl start diag-agent\n\n# Aturar el servei\nsudo systemctl stop diag-agent\n\n# Reiniciar el servei\nsudo systemctl restart diag-agent\n\n# Veure l'estat\nsudo systemctl status diag-agent\n\n# Habilitar inici autom\u00e0tic\nsudo systemctl enable diag-agent\n</code></pre>"},{"location":"agent/configuracio/#post-auditoria","title":"Post-Auditoria","text":"<p>Opcions despr\u00e9s de l'auditoria</p> <p>Un cop finalitzada l'auditoria, l'eina pot romandre instal\u00b7lada al servidor del client si aix\u00ed ho desitja. Aquesta opci\u00f3 permet que el mateix departament t\u00e8cnic pugui continuar fent monitoratges peri\u00f2dics i auditories internes de seguretat.</p> <p>En cas contrari, Cybershield Solutions pot procedir a la desinstal\u00b7laci\u00f3 completa dels components, deixant el sistema exactament com abans de la intervenci\u00f3.</p>"},{"location":"agent/context/","title":"Context del Projecte","text":"<p>L'empresa creada per a aquest projecte rep el nom de Cybershield Solutions, S.L., i neix amb una idea molt clara: oferir serveis professionals d'auditoria de seguretat inform\u00e0tica, an\u00e0lisi de vulnerabilitats i assessorament t\u00e8cnic per millorar la protecci\u00f3 d'infraestructures digitals. Tot i que \u00e9s una empresa de nova creaci\u00f3, el seu enfocament \u00e9s completament professional i orientat a oferir resultats reals i mesurables.</p>"},{"location":"agent/context/#lequip","title":"L'Equip","text":"<p>Actualment, Cybershield Solutions est\u00e0 formada per un \u00fanic membre fundador, Vitaliy Domin, t\u00e8cnic superior en Administraci\u00f3 de Sistemes Inform\u00e0tics en Xarxa amb especialitzaci\u00f3 en Ciberseguretat. Tot i aix\u00f2, l'empresa es troba en proc\u00e9s de creixement i ja treballa amb col\u00b7laboradors externs i professionals del sector per cobrir \u00e0rees espec\u00edfiques com el desenvolupament web, la resposta a incidents i la consultoria de seguretat.</p>"},{"location":"agent/context/#estructura-i-serveis","title":"Estructura i Serveis","text":"<p>L'estructura de l'empresa \u00e9s \u00e0gil i flexible, cosa que permet adaptar-se a projectes de diferent abast, des d'auditories puntuals fins a plans complets de millora de seguretat per a entorns corporatius o administracions p\u00fabliques. Cybershield Solutions aposta per l'\u00fas d'eines de codi obert, metodologies automatitzades i entorns virtualitzats per garantir efici\u00e8ncia i transpar\u00e8ncia en cada auditoria.</p> <p>En l'\u00e0mbit t\u00e8cnic, l'empresa centra els seus serveis principals en tres l\u00ednies:</p> <ul> <li>Auditories de seguretat i an\u00e0lisi de vulnerabilitats, tant en servidors locals com en entorns cloud.</li> <li>Implementaci\u00f3 de millores i refor\u00e7 de seguretat, basant-se en les conclusions obtingudes durant les auditories.</li> <li>Desenvolupament d'eines pr\u00f2pies, com l'aplicaci\u00f3 Diag Agent, creada espec\u00edficament per detectar vulnerabilitats, revisar serveis i generar informes professionals en format PDF i CSV.</li> </ul>"},{"location":"agent/context/#filosofia","title":"Filosofia","text":"<p>El valor afegit de Cybershield Solutions \u00e9s la seva capacitat d'oferir un tracte directe, personalitzat i t\u00e8cnicament rigor\u00f3s, combinant coneixements avan\u00e7ats de sistemes, xarxes i seguretat amb una visi\u00f3 pr\u00e0ctica del m\u00f3n real. La seva filosofia es pot resumir en tres paraules que tamb\u00e9 formen part del seu lema corporatiu:</p> <p>Lema Corporatiu</p> <p>Protect. Detect. Secure.</p>"},{"location":"agent/empresa-auditada/","title":"Empresa Auditada","text":"<p>L'empresa auditada en aquest projecte \u00e9s l'Institut de l'Ebre, un centre educatiu de formaci\u00f3 professional amb una forta orientaci\u00f3 cap a les tecnologies de la informaci\u00f3 i la comunicaci\u00f3. L'auditoria s'ha centrat especialment en la seva infraestructura inform\u00e0tica, amb l'objectiu d'identificar possibles vulnerabilitats i proposar millores en mat\u00e8ria de seguretat i efici\u00e8ncia del sistema.</p> <p>L'Institut de l'Ebre disposa d'una infraestructura pr\u00f2pia de servidors i xarxes, gestionada internament pel seu departament d'inform\u00e0tica. El centre utilitza diversos serveis digitals per a la gesti\u00f3 acad\u00e8mica, l'allotjament de webs i aplicacions internes, i l'acc\u00e9s dels estudiants i docents a diferents recursos formatius. Per aquesta ra\u00f3, la seguretat i la disponibilitat dels seus sistemes s\u00f3n aspectes cr\u00edtics per garantir el bon funcionament diari del centre.</p>"},{"location":"agent/empresa-auditada/#infraestructura-tecnologica","title":"Infraestructura tecnol\u00f2gica","text":"<p>L'entorn analitzat consta de dos servidors principals configurats en alta disponibilitat (HA), basats en sistemes operatius Linux Ubuntu Server LTS, una plataforma escollida per la seva estabilitat, seguretat i compatibilitat amb eines d'auditoria.</p> <p>Aquests servidors allotgen els principals serveis del centre, entre ells:</p> <ul> <li>Plataforma de gesti\u00f3 interna (bases de dades i aplicacions acad\u00e8miques).</li> <li>Servidor web amb contingut docent i administratiu.</li> <li>Sistema d'autenticaci\u00f3 i gesti\u00f3 d'usuaris (LDAP).</li> <li>Repositoris i serveis d'arxiu compartit per a docents i estudiants.</li> <li>Correu electr\u00f2nic intern i eines de comunicaci\u00f3.</li> </ul> <p>Els dos servidors funcionen en un entorn virtualitzat, fet que permet desplegar m\u00e0quines addicionals per a proves, c\u00f2pies de seguretat i desenvolupament.</p> <p>En l'\u00e0mbit de xarxa, el centre disposa de VLANs segmentades per a cada tipus d'usuari (administraci\u00f3, professorat, alumnat i convidats), millorant la seguretat i el control d'accessos.</p> <p>Pol\u00edtica de Sistemes</p> <p>La pol\u00edtica de sistemes del centre estableix que tota la infraestructura inform\u00e0tica ha d'estar basada exclusivament en entorns Linux, reduint aix\u00ed riscos derivats de vulnerabilitats t\u00edpiques d'altres plataformes.</p>"},{"location":"agent/empresa-auditada/#objectiu-de-lauditoria","title":"Objectiu de l'auditoria","text":"<p>L'auditoria encarregada a Cybershield Solutions, S.L. t\u00e9 com a objectiu principal avaluar l'estat de seguretat dels servidors i serveis principals basats en Linux Ubuntu Server, mitjan\u00e7ant una an\u00e0lisi t\u00e8cnica i un informe amb propostes de millora.</p> <p>Els punts principals de l'auditoria s\u00f3n:</p> <ul> <li>Verificar la configuraci\u00f3 dels serveis cr\u00edtics i la seva exposici\u00f3 a la xarxa.</li> <li>Detectar vulnerabilitats conegudes en paquets i serveis del sistema.</li> <li>Analitzar registres del sistema i accessos fallits per detectar intents d'intrusi\u00f3.</li> <li>Avaluar l'\u00fas de bones pr\u00e0ctiques en la gesti\u00f3 d'usuaris, permisos i actualitzacions.</li> <li>Generar un informe t\u00e8cnic automatitzat amb resultats i recomanacions espec\u00edfiques per entorns Ubuntu.</li> </ul>"},{"location":"agent/empresa-auditada/#abast-i-limitacions","title":"Abast i limitacions","text":"<p>L'auditoria s'ha limitat a l'an\u00e0lisi interna de la infraestructura del centre, sense accedir a informaci\u00f3 personal o dades acad\u00e8miques dels usuaris.</p> <p>S'han revisat \u00fanicament els servidors de producci\u00f3 i proves, aix\u00ed com els principals serveis de xarxa, sistemes d'autenticaci\u00f3 i portals interns.</p> <p>Tipus d'Auditoria</p> <p>No s'ha dut a terme cap prova d'intrusi\u00f3 externa o simulaci\u00f3 d'atac, ja que l'objectiu d'aquesta auditoria \u00e9s de tipus preventiu i de diagn\u00f2stic, centrada en la detecci\u00f3 de vulnerabilitats i l'avaluaci\u00f3 de configuracions de seguretat.</p>"},{"location":"agent/empresa-auditada/#durada-del-projecte","title":"Durada del projecte","text":"<p>L'auditoria s'ha desenvolupat al llarg de tres sprints dins del per\u00edode del projecte intermodular, amb una durada total aproximada de sis setmanes.</p> <p>Durant aquest temps s'han dut a terme la planificaci\u00f3, l'an\u00e0lisi t\u00e8cnica, la recopilaci\u00f3 d'informaci\u00f3 i la redacci\u00f3 de l'informe final amb les propostes de millora.</p>"},{"location":"agent/hardening/","title":"Hardening i Seguretat","text":"<p>El Diag Agent ha estat sotm\u00e8s a un proc\u00e9s de hardening rigor\u00f3s per garantir que l'eina d'auditoria no es converteixi en un vector d'atac per si mateixa.</p>"},{"location":"agent/hardening/#mesures-implementades","title":"Mesures Implementades","text":"<p>S'han abordat vulnerabilitats cr\u00edtiques identificades en auditories de seguretat internes:</p>"},{"location":"agent/hardening/#1-eliminacio-de-rce-remote-code-execution","title":"1. Eliminaci\u00f3 de RCE (Remote Code Execution)","text":"<p>S'ha eliminat completament l'endpoint <code>/api/run_cmd</code> que permetia l'execuci\u00f3 de comandaments arbitraris de shell.  - Abans: Qualsevol usuari amb acc\u00e9s a la xarxa podia executar comandes com a root. - Ara: Nom\u00e9s les funcions predefinides del sistema poden invocar processos externs, utilitzant arguments santificats.</p>"},{"location":"agent/hardening/#2-proteccio-contra-xss-cross-site-scripting","title":"2. Protecci\u00f3 contra XSS (Cross-Site Scripting)","text":"<p>Com que l'agent mostra resultats d'escanejos externs (que poden contenir codi malici\u00f3s), s'ha implementat una protecci\u00f3 de doble capa: - Server-Side: Funci\u00f3 <code>h_esc()</code> en Python per escapar car\u00e0cters especials en dades renderitzades pel servidor. - Client-Side: Funci\u00f3 <code>esc()</code> a la interf\u00edcie web (JavaScript) per evitar injeccions de DOM quan es carreguen resultats din\u00e0micament.</p>"},{"location":"agent/hardening/#3-validacio-darguments-shell-hardening","title":"3. Validaci\u00f3 d'Arguments (Shell Hardening)","text":"<p>Per a eines com Nmap, s'utilitza una llista blanca estricta de par\u00e0metres: - \u00das de <code>shlex.split()</code> per al parseig segur. - Bloqueig de metaclasses de shell (<code>&amp;</code>, <code>;</code>, <code>|</code>, <code>$</code>, etc.). - Prohibici\u00f3 de flags perillosos com <code>--script</code>.</p>"},{"location":"agent/hardening/#restriccions-dacces","title":"Restriccions d'Acc\u00e9s","text":"<p>L'acc\u00e9s a l'aplicaci\u00f3 est\u00e0 limitat per defecte: - Whitelisting d'IPs: \u00das de la variable <code>ALLOWED_NETWORKS</code> per permetre l'acc\u00e9s nom\u00e9s des de subxarxes confiables (ex: la xarxa d'administraci\u00f3). - Interface Binding: L'agent es pot configurar per escoltar nom\u00e9s en <code>localhost</code> o una interf\u00edcie VPN espec\u00edfica.</p>"},{"location":"agent/hardening/#disseny-de-zero-trust","title":"Disseny de Zero-Trust","text":"<p>L'agent segueix el principi de m\u00ednim privilegi: - Els resultats dels escanejos es guarden en estructures de dades en mem\u00f2ria (<code>deques</code>) amb l\u00edmits de tamany per evitar atacs de denegaci\u00f3 de servei (DoS) per esgotament de mem\u00f2ria. - L'execuci\u00f3 de binaris externs utilitza <code>timeout</code> per evitar processos zombis.</p> <p>Millora de Seguretat</p> <p>Si vols augmentar la seguretat, es recomana desplegar el Diag Agent darrere d'un proxy invers (com Nginx) amb autenticaci\u00f3 b\u00e0sica o TLS client certificates.</p>"},{"location":"agent/installacio/","title":"Instal\u00b7laci\u00f3","text":"<p>Guia completa per instal\u00b7lar el Diag Agent en un servidor Ubuntu.</p>"},{"location":"agent/installacio/#requisits-previs","title":"Requisits Previs","text":""},{"location":"agent/installacio/#sistema-operatiu","title":"Sistema Operatiu","text":"<ul> <li>Ubuntu Server 20.04 LTS o 22.04 LTS</li> <li>Arquitectura: x86_64 (amd64)</li> <li>RAM m\u00ednima: 2GB</li> <li>Espai en disc: 5GB</li> </ul>"},{"location":"agent/installacio/#acces","title":"Acc\u00e9s","text":"<ul> <li>Acc\u00e9s root o sudo</li> <li>Connexi\u00f3 a Internet (per descarregar depend\u00e8ncies)</li> </ul>"},{"location":"agent/installacio/#installacio-automatica","title":"Instal\u00b7laci\u00f3 Autom\u00e0tica","text":""},{"location":"agent/installacio/#pas-1-copiar-fitxers","title":"Pas 1: Copiar Fitxers","text":"<pre><code># Opci\u00f3 A: Via SCP\nscp setup_diag.sh diag_agent_single.py cshield.png user@server:/opt/diag/\n\n# Opci\u00f3 B: Via USB\nmount /dev/sdb1 /mnt\ncp /mnt/diag/* /opt/diag/\numount /mnt\n</code></pre>"},{"location":"agent/installacio/#pas-2-permisos-dexecucio","title":"Pas 2: Permisos d'Execuci\u00f3","text":"<pre><code>cd /opt/diag\nsudo chmod +x setup_diag.sh diag_agent_single.py\n</code></pre>"},{"location":"agent/installacio/#pas-3-executar-installador","title":"Pas 3: Executar Instal\u00b7lador","text":"<pre><code>sudo ./setup_diag.sh [IP_BIND] [XARXA_PERMESA] [PORT]\n</code></pre> <p>Par\u00e0metres:</p> Par\u00e0metre Descripci\u00f3 Valor per Defecte <code>IP_BIND</code> IP del servidor <code>hostname -I</code> <code>XARXA_PERMESA</code> CIDR de xarxa permesa <code>IP.0/24</code> <code>PORT</code> Port del servei <code>8080</code> <p>Exemple: <pre><code>sudo ./setup_diag.sh 192.168.1.100 192.168.1.0/24 8080\n</code></pre></p>"},{"location":"agent/installacio/#dependencies-installades","title":"\ud83d\udce6 Depend\u00e8ncies Instal\u00b7lades","text":""},{"location":"agent/installacio/#paquets-apt","title":"Paquets APT","text":"<pre><code>PKGS=(\n    python3              # Python 3.x\n    python3-pip          # Gestor de paquets pip\n    python3-venv         # Entorns virtuals\n    python3-dev          # Headers de desenvolupament\n    build-essential      # Compiladors (gcc, make)\n    curl jq git          # Utilitats\n    nmap                 # Esc\u00e0ner de xarxa\n    ssh-audit            # Auditoria SSH\n    smbclient            # Client SMB\n    samba-common-bin     # Eines Samba\n    libpango-1.0-0       # Depend\u00e8ncia WeasyPrint\n    libpangocairo-1.0-0  # Depend\u00e8ncia WeasyPrint\n    libcairo2            # Renderitzaci\u00f3 PDF\n)\n</code></pre>"},{"location":"agent/installacio/#paquets-python-venv","title":"Paquets Python (venv)","text":"<pre><code>pip install \\\n    flask              # Framework web\n    psutil             # M\u00e8triques del sistema\n    weasyprint         # Generaci\u00f3 PDF\n    impacket           # Protocol SMB\n    ldap3              # Client LDAP\n    pyyaml             # Parsing YAML\n    pyhanko[crypto]    # Signatura digital PDF\n    cryptography       # Criptografia\n    pyhanko-certvalidator  # Validaci\u00f3 certificats\n</code></pre>"},{"location":"agent/installacio/#eines-externes","title":"Eines Externes","text":"<p>enum4linux-ng es clona des de GitHub: <pre><code>git clone https://github.com/cddmp/enum4linux-ng.git\n</code></pre></p>"},{"location":"agent/installacio/#certificats-de-signatura","title":"Certificats de Signatura","text":"<p>L'instal\u00b7lador genera autom\u00e0ticament un certificat auto-signat:</p> <pre><code># Directori de certificats\nCERT_DIR=\"${SCRIPT_DIR}/certs\"\n\n# Genera clau privada RSA 2048 bits\nopenssl genrsa -out \"${CERT_DIR}/cybershield.key\" 2048\n\n# Genera certificat auto-signat (v\u00e0lid 10 anys)\nopenssl req -new -x509 \\\n    -key \"${CERT_DIR}/cybershield.key\" \\\n    -out \"${CERT_DIR}/cybershield.crt\" \\\n    -days 3650 \\\n    -subj \"/C=ES/ST=Barcelona/L=Barcelona/O=Cybershield Solutions/OU=Security Audit Division/CN=Cybershield Solutions/emailAddress=security@cybershield.solutions\"\n\n# Protegir clau privada\nchmod 600 \"${CERT_DIR}/cybershield.key\"\n</code></pre>"},{"location":"agent/installacio/#fitxers-generats","title":"Fitxers Generats","text":"<pre><code>/opt/diag/certs/\n\u251c\u2500\u2500 cybershield.key   # Clau privada (600)\n\u2514\u2500\u2500 cybershield.crt   # Certificat p\u00fablic\n</code></pre>"},{"location":"agent/installacio/#servei-systemd","title":"Servei Systemd","text":"<p>L'instal\u00b7lador crea un servei systemd:</p>"},{"location":"agent/installacio/#fitxer-de-servei","title":"Fitxer de Servei","text":"<pre><code># /etc/systemd/system/diag-agent.service\n[Unit]\nDescription=Diag Agent (no-auth) - portable version\nAfter=network.target\n\n[Service]\nType=simple\nExecStart=/opt/diag/venv/bin/python3 /opt/diag/diag_agent_single.py --host 192.168.1.100 --port 8080 --allow-from 192.168.1.0/24\nWorkingDirectory=/opt/diag\nRestart=on-failure\nUser=root\nStandardOutput=journal\nStandardError=journal\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>"},{"location":"agent/installacio/#gestio-del-servei","title":"Gesti\u00f3 del Servei","text":"<pre><code># Iniciar servei\nsudo systemctl start diag-agent\n\n# Aturar servei\nsudo systemctl stop diag-agent\n\n# Reiniciar servei\nsudo systemctl restart diag-agent\n\n# Veure estat\nsudo systemctl status diag-agent\n\n# Habilitar a l'arrencada\nsudo systemctl enable diag-agent\n\n# Deshabilitar\nsudo systemctl disable diag-agent\n</code></pre>"},{"location":"agent/installacio/#logs-del-servei","title":"Logs del Servei","text":"<pre><code># Veure logs en temps real\njournalctl -u diag-agent -f\n\n# \u00daltimes 100 l\u00ednies\njournalctl -u diag-agent -n 100\n\n# Logs des d'avui\njournalctl -u diag-agent --since today\n</code></pre>"},{"location":"agent/installacio/#verificacio","title":"Verificaci\u00f3","text":""},{"location":"agent/installacio/#comprovar-servei","title":"Comprovar Servei","text":"<pre><code>sudo systemctl status diag-agent\n</code></pre> <p>Sortida esperada: <pre><code>\u25cf diag-agent.service - Diag Agent (no-auth) - portable version\n     Loaded: loaded (/etc/systemd/system/diag-agent.service; enabled)\n     Active: active (running) since Mon 2025-01-15 10:00:00 CET\n   Main PID: 1234 (python3)\n      Tasks: 1 (limit: 4915)\n     Memory: 50.0M\n</code></pre></p>"},{"location":"agent/installacio/#comprovar-acces-web","title":"Comprovar Acc\u00e9s Web","text":"<pre><code>curl -s http://localhost:8080/api/status | jq\n</code></pre> <p>O des d'un navegador: <pre><code>http://192.168.1.100:8080/\n</code></pre></p>"},{"location":"agent/installacio/#firewall","title":"\ud83d\udd25 Firewall","text":"<p>Si utilitzes <code>ufw</code>:</p> <pre><code># Permetre el port del Diag Agent\nsudo ufw allow 8080/tcp\n\n# Verificar regles\nsudo ufw status\n</code></pre>"},{"location":"agent/installacio/#desinstallacio","title":"Desinstal\u00b7laci\u00f3","text":"<p>Per eliminar completament el Diag Agent:</p> <pre><code># Aturar i deshabilitar servei\nsudo systemctl stop diag-agent\nsudo systemctl disable diag-agent\n\n# Eliminar fitxer de servei\nsudo rm /etc/systemd/system/diag-agent.service\nsudo systemctl daemon-reload\n\n# Eliminar fitxers\nsudo rm -rf /opt/diag\n</code></pre> <p>Actualitzacions</p> <p>Per actualitzar el Diag Agent, simplement reempla\u00e7a el fitxer <code>diag_agent_single.py</code> i reinicia el servei: <pre><code>sudo cp diag_agent_single_new.py /opt/diag/diag_agent_single.py\nsudo systemctl restart diag-agent\n</code></pre></p>"},{"location":"agent/integracions/","title":"Integracions i Reports","text":"<p>El Diag Agent est\u00e0 dissenyat per facilitar la distribuci\u00f3 dels resultats d'auditoria de manera r\u00e0pida i professional.</p>"},{"location":"agent/integracions/#integracio-amb-telegram","title":"Integraci\u00f3 amb Telegram","text":"<p>L'agent permet enviar informes d'auditoria directament al teu dispositiu m\u00f2bil a trav\u00e9s de Telegram.</p>"},{"location":"agent/integracions/#com-configurar-lo","title":"Com configurar-lo:","text":""},{"location":"agent/integracions/#com-configurar-lo_1","title":"Com configurar-lo:","text":"<ol> <li>Variables d'Entorn: Per seguretat, no guardis el token al codi. Configura'l al teu sistema:    <pre><code>export TELEGRAM_BOT_TOKEN=\"el_teu_token_aqu\u00ed\"\n</code></pre></li> <li>Executa el Bot Independent: Copia <code>diagbot.py</code> a la teva VM de bots i executa'l.</li> <li>Automatitzaci\u00f3 (systemd): Utilitza el fitxer <code>diagbot.service</code> proporcionat per mantenir el bot actiu:    <pre><code>sudo cp diagbot.service /etc/systemd/system/\nsudo systemctl daemon-reload\nsudo systemctl enable diagbot\nsudo systemctl start diagbot\n</code></pre></li> <li>Identifica el teu Chat ID: Envia <code>/start</code> al teu bot de Telegram. Ell et respondr\u00e0 amb el teu ID personal.</li> <li>Configura el Diag Agent: A la pestanya de resultats de l'eina principal, introdueix el teu ID al camp \"Your Chat ID\".</li> <li>Clica \"Send\": El bot de Cybershield t'enviar\u00e0 el document PDF en pocs segons.</li> </ol>"},{"location":"agent/integracions/#avantatges","title":"Avantatges:","text":"<ul> <li>Immediatesa: Reps l'auditoria sense haver de descarregar fitxers al PC.</li> <li>Portabilitat: Acc\u00e9s als resultats des de qualsevol lloc.</li> <li>Privacitat: Els informes nom\u00e9s s'envien al ID que tu especifiquis.</li> </ul>"},{"location":"agent/integracions/#informes-pdf-professionals","title":"Informes PDF Professionals","text":"<p>Utilitzant el motor WeasyPrint, l'agent genera informes en format PDF d'alta qualitat que inclouen:</p> <ul> <li>Resum Executiu: Gr\u00e0fiques i KPIs de l'estat del sistema.</li> <li>Detall T\u00e8cnic: Tota la informaci\u00f3 de vulnerabilitats, ports i serveis.</li> <li>Branding Personalitzat: Inclou el logotip de Cybershield Solutions.</li> <li>Signatura Digital: Cada PDF est\u00e0 signat electr\u00f2nicament per garantir-ne la integritat.</li> </ul>"},{"location":"agent/integracions/#signatura-digital-pyhanko","title":"Signatura Digital (PyHanko)","text":"<p>Tots els informes generats per l'agent porten una signatura digital verificable:</p> <ul> <li>Autenticitat: Confirma que l'informe prov\u00e9 del Diag Agent.</li> <li>Integritat: Qualsevol modificaci\u00f3 posterior del PDF invalidar\u00e0 la signatura.</li> <li>Certificat: El sistema genera un certificat de 2048 bits durant la instal\u00b7laci\u00f3.</li> </ul>"},{"location":"agent/integracions/#exportacio-csv","title":"Exportaci\u00f3 CSV","text":"<p>Per a an\u00e0lisis posteriors o importaci\u00f3 en altres eines (bases de dades, Excel), l'agent permet l'exportaci\u00f3 de totes les taules en format CSV, garantint la interoperabilitat de les dades.</p> <p>Clau de Bot de Telegram</p> <p>El token del bot est\u00e0 preconfigurat a l'agent per oferir el servei d'enviament de manera transparent a l'usuari. No cal que l'usuari cre\u00ef el seu propi bot per utilitzar aquesta funcionalitat.</p>"},{"location":"agent/moduls/","title":"M\u00f2duls de Seguretat","text":"<p>El Diag Agent integra m\u00faltiples eines de seguretat de codi obert en un \u00fanic tauler de control unificat.</p>"},{"location":"agent/moduls/#scanner-de-vulnerabilitats-trivy","title":"Scanner de Vulnerabilitats (Trivy)","text":""},{"location":"agent/moduls/#descripcio","title":"Descripci\u00f3","text":"<p>Trivy \u00e9s un esc\u00e0ner de vulnerabilitats complet per a contenidors, sistemes de fitxers i repositoris git.</p>"},{"location":"agent/moduls/#configuracio-al-diag-agent","title":"Configuraci\u00f3 al Diag Agent","text":"<pre><code>def collect_trivy(limit=200):\n    \"\"\"\n    Analitza el sistema de fitxers (rootfs) per detectar CVEs.\n    Optimitzaci\u00f3: Omit directoris temporals per reduir temps.\n    \"\"\"\n    cmd = \"trivy fs / --skip-dirs /tmp --skip-dirs /var/cache -f json\"\n    result = subprocess.run(cmd, shell=True, capture_output=True, timeout=300)\n    ...\n</code></pre>"},{"location":"agent/moduls/#funcionalitats","title":"Funcionalitats","text":"Caracter\u00edstica Descripci\u00f3 Escaneig rootfs Analitza tot el sistema de fitxers Filtrat per severitat CRITICAL, HIGH, MEDIUM, LOW Base de dades CVE actualitzada cont\u00ednuament Optimitzaci\u00f3 Skip de /tmp, /var/cache L\u00edmit de resultats Configurable (per defecte 200)"},{"location":"agent/moduls/#sortida","title":"Sortida","text":"<pre><code>{\n  \"Results\": [\n    {\n      \"Target\": \"apt\",\n      \"Vulnerabilities\": [\n        {\n          \"VulnerabilityID\": \"CVE-2023-XXXX\",\n          \"PkgName\": \"openssl\",\n          \"Severity\": \"HIGH\",\n          \"Title\": \"Buffer overflow in...\",\n          \"Description\": \"...\"\n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"agent/moduls/#auditoria-de-xarxa-nmap","title":"Auditoria de Xarxa (Nmap)","text":""},{"location":"agent/moduls/#descripcio_1","title":"Descripci\u00f3","text":"<p>Nmap \u00e9s l'esc\u00e0ner de xarxa m\u00e9s utilitzat, integrat amb validaci\u00f3 d'arguments per seguretat.</p>"},{"location":"agent/moduls/#classificacio-de-ports","title":"Classificaci\u00f3 de Ports","text":"<pre><code>class NmapParser:\n    DANGEROUS_PORTS = {\n        21: \"FTP - Unencrypted file transfer protocol\",\n        23: \"Telnet - Unencrypted remote access (use SSH)\",\n        25: \"SMTP - Mail server (check auth)\",\n        69: \"TFTP - Trivial FTP (no auth)\",\n        110: \"POP3 - Unencrypted mail\",\n        135: \"MSRPC - Windows RPC\",\n        139: \"NetBIOS - Windows shares\",\n        445: \"SMB - Windows/Samba shares\",\n        512: \"rexec - Remote exec\",\n        513: \"rlogin - Remote login\",\n        514: \"RSH - Remote shell\",\n        1433: \"MSSQL - Database\",\n        1521: \"Oracle - Database\",\n        3306: \"MySQL - Database\",\n        3389: \"RDP - Remote Desktop\",\n        5432: \"PostgreSQL - Database\",\n        5900: \"VNC - Remote desktop\",\n        6379: \"Redis - Cache (no auth default)\"\n    }\n</code></pre>"},{"location":"agent/moduls/#arguments-segurs-permesos","title":"Arguments Segurs Permesos","text":"<pre><code>SINGLE_TOKEN_WHITELIST = {\"-p-\", \"-Pn\", \"-sV\", \"-v\", \"-vv\", \"-A\"}\nT_TUNING_RE = re.compile(r\"^-T[0-5]$\")  # -T0 a -T5\n</code></pre> <p>Seguretat</p> <ul> <li>\u274c <code>--script*</code> rebutjat</li> <li>\u274c Metacar\u00e0cters shell rebutjats</li> <li>\u2705 Nom\u00e9s flags de la whitelist</li> </ul>"},{"location":"agent/moduls/#exemple-dus","title":"Exemple d'\u00das","text":"<pre><code># Via API\ncurl -X POST http://localhost:8080/api/nmap_scan \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"target\": \"192.168.1.1\", \"extra_args\": \"-sV -T4\"}'\n</code></pre>"},{"location":"agent/moduls/#auditoria-ssh-ssh-audit","title":"Auditoria SSH (SSH-Audit)","text":""},{"location":"agent/moduls/#descripcio_2","title":"Descripci\u00f3","text":"<p>M\u00f2dul espec\u00edfic que analitza la configuraci\u00f3 del servei SSH, detectant configuracions insegures.</p>"},{"location":"agent/moduls/#patrons-de-deteccio","title":"Patrons de Detecci\u00f3","text":"<pre><code>class SSHAuditParser:\n    FAIL_PATTERNS = [\n        r'\\(fail\\)',\n        r'weak\\s+\\(',\n        r'broken',\n        r'vulnerable',\n        r'deprecated',\n        r'SHA-?1',\n        r'MD5',\n        r'3DES',\n        r'RC4',\n        r'CBC mode'\n    ]\n\n    SECURE_PATTERNS = [\n        r'ECDH',\n        r'ed25519',\n        r'chacha20',\n        r'gcm@openssh',\n        r'umac-128'\n    ]\n</code></pre>"},{"location":"agent/moduls/#classificacio-dalgoritmes","title":"Classificaci\u00f3 d'Algoritmes","text":"Nivell Descripci\u00f3 Exemples \ud83d\udfe2 Secure Recomanats Ed25519, ChaCha20, AES-GCM \ud83d\udfe1 Attention Acceptables per\u00f2 millorables ECDSA, AES-CTR \ud83d\udd34 Fail Insegurs, eliminar 3DES, MD5, SHA1, RC4"},{"location":"agent/moduls/#report-generat","title":"Report Generat","text":"<pre><code>@dataclass\nclass SSHAuditReport:\n    banner: str = \"\"\n    software: str = \"\"\n    protocol_version: str = \"\"\n    kex_secure: List[SSHAlgorithm] = field(default_factory=list)\n    kex_weak: List[SSHAlgorithm] = field(default_factory=list)\n    hostkey_secure: List[SSHAlgorithm] = field(default_factory=list)\n    hostkey_weak: List[SSHAlgorithm] = field(default_factory=list)\n    enc_secure: List[SSHAlgorithm] = field(default_factory=list)\n    enc_weak: List[SSHAlgorithm] = field(default_factory=list)\n    mac_secure: List[SSHAlgorithm] = field(default_factory=list)\n    mac_weak: List[SSHAlgorithm] = field(default_factory=list)\n    fingerprints: Dict[str, str] = field(default_factory=dict)\n    recommendations: List[str] = field(default_factory=list)\n    critical_issues: List[str] = field(default_factory=list)\n    hardening_actions: List[str] = field(default_factory=list)\n</code></pre>"},{"location":"agent/moduls/#recomanacions-de-hardening","title":"Recomanacions de Hardening","text":"<p>L'eina genera autom\u00e0ticament recomanacions com:</p> <pre><code>\u2705 Disable weak algorithms in /etc/ssh/sshd_config\n\u2705 Use Ed25519 keys instead of RSA\n\u2705 Set KexAlgorithms curve25519-sha256@libssh.org\n\u2705 Set Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com\n\u2705 Set MACs hmac-sha2-512-etm@openssh.com\n</code></pre>"},{"location":"agent/moduls/#enumeracio-smb-enum4linux","title":"Enumeraci\u00f3 SMB (Enum4Linux)","text":""},{"location":"agent/moduls/#descripcio_3","title":"Descripci\u00f3","text":"<p>M\u00f2dul per auditar servidors Samba i entorns h\u00edbrids Windows/Linux.</p>"},{"location":"agent/moduls/#funcionalitats_1","title":"Funcionalitats","text":"<pre><code>def collect_enum4linux(target_str=\"192.168.1.1\", options=None):\n    \"\"\"\n    Executes enum4linux/enum4linux-ng against a target for SMB enumeration.\n\n    Args:\n        target_str: IP address or hostname\n        options: dict with keys like 'users', 'shares', 'groups', 'policy'\n\n    Returns:\n        Structured dict with parsed results\n    \"\"\"\n</code></pre>"},{"location":"agent/moduls/#opcions-descaneig","title":"Opcions d'Escaneig","text":"Opci\u00f3 Flag Descripci\u00f3 <code>users</code> <code>-U</code> Enumerar usuaris <code>shares</code> <code>-S</code> Llistar shares <code>groups</code> <code>-G</code> Grups i membres <code>policy</code> <code>-P</code> Pol\u00edtica de contrasenyes <code>rid_cycling</code> <code>-r</code> Enumerar RIDs (brute-force)"},{"location":"agent/moduls/#sortida-parsejada","title":"Sortida Parsejada","text":"<pre><code>def parse_enum4linux_output(raw_text, target, duration):\n    return {\n        \"target\": target,\n        \"duration\": duration,\n        \"os_info\": {...},\n        \"users\": [...],\n        \"shares\": [...],\n        \"groups\": [...],\n        \"password_policy\": {...},\n        \"domain_info\": {...}\n    }\n</code></pre>"},{"location":"agent/moduls/#comparativa-de-moduls","title":"Comparativa de M\u00f2duls","text":"M\u00f2dul Temps T\u00edpic Risc Invasivitat Trivy 30-120s Cap Nom\u00e9s lectura Nmap 10-300s Baix Escaneig actiu SSH-Audit 2-5s Cap Una connexi\u00f3 SSH Enum4Linux 10-60s Baix Queries SMB <p>Bones Pr\u00e0ctiques</p> <ol> <li>Executar Trivy primer per tenir una visi\u00f3 general</li> <li>Utilitzar Nmap amb <code>-sV</code> per detectar versions</li> <li>SSH-Audit per validar configuraci\u00f3 SSH</li> <li>Enum4Linux nom\u00e9s si hi ha serveis SMB</li> </ol>"},{"location":"agent/pentest/","title":"Pentest Agent (Auditoria Web)","text":"<p>El Pentest Agent \u00e9s un m\u00f2dul especialitzat integrat al Diag Agent que permet realitzar auditories de seguretat en aplicacions web. Est\u00e0 dissenyat per detectar vulnerabilitats comunes del OWASP Top 10.</p>"},{"location":"agent/pentest/#capacitats-del-modul","title":"Capacitats del M\u00f2dul","text":"<p>L'agent (<code>pentest_agent.py</code>) \u00e9s un motor aut\u00f2nom que executa els seg\u00fcents motors d'escaneig:</p> Motor Descripci\u00f3 SQL Injection Detecci\u00f3 de vulnerabilitats basades en temps, errors i unions (Union-based). XSS (Cross-Site Scripting) Identificaci\u00f3 de reflexi\u00f3 de payloads en par\u00e0metres GET/POST i formularis. LFI / Path Traversal Comprovaci\u00f3 d'acc\u00e9s a fitxers sensibles com <code>/etc/passwd</code>. CORS Misconfiguration An\u00e0lisi de pol\u00edtiques d'origen creuat excessivament permissives. Security Headers Verificaci\u00f3 de la pres\u00e8ncia i configuraci\u00f3 de CSP, HSTS, X-Frame-Options, etc. Cookie Security Revisi\u00f3 dels atributs <code>HttpOnly</code>, <code>Secure</code> i <code>SameSite</code>. Sensitive File Discovery Detecci\u00f3 de fitxers exposats (.env, config.php, backup.sql, etc.)"},{"location":"agent/pentest/#flux-de-lescaneig","title":"Flux de l'Escaneig","text":"<p>L'escaneig segueix un proc\u00e9s estructurat per maximitzar la cobertura sense ser excessivament invasiu:</p> <ol> <li>Reconnaissance: Identificaci\u00f3 de la tecnologia del servidor i headers inicials.</li> <li>Crawling: Descobriment recursiu de rutes, formularis i par\u00e0metres (limitat per profunditat).</li> <li>Fuzzing i Payload Injection: Proves actives amb payloads optimitzats per a cada tipus de vulnerabilitat.</li> <li>An\u00e0lisi de Respostes: Verificaci\u00f3 de signatures d'error, temps de resposta o reflexi\u00f3 de contingut.</li> </ol>"},{"location":"agent/pentest/#explanationdatabase-context-professional","title":"ExplanationDatabase - Context Professional","text":"<p>Una de les millores m\u00e9s importants del m\u00f2dul \u00e9s la classe <code>ExplanationDatabase</code>, que proporciona explicacions llegibles per humans per a cada tipus de vulnerabilitat detectada.</p>"},{"location":"agent/pentest/#per-que-es-important","title":"Per qu\u00e8 \u00e9s important?","text":"<ul> <li>Abans: Els informes autom\u00e0tics nom\u00e9s mostraven \"SQL Injection detectat\" sense context addicional</li> <li>Ara: Cada descoberta inclou una explicaci\u00f3 d'1-2 par\u00e0grafs sobre qu\u00e8 significa i per qu\u00e8 \u00e9s important</li> <li>Benefici: Els informes s\u00f3n comprensibles per a auditors, directius i professors sense coneixements t\u00e8cnics profunds</li> </ul>"},{"location":"agent/pentest/#exemple-de-funcionament","title":"Exemple de Funcionament","text":"<pre><code>class ExplanationDatabase:\n    EXPLANATIONS = {\n        \"Missing Security Headers\": {\n            \"text\": \"The application response does not include one or more recommended HTTP security headers (such as Content-Security-Policy, X-Frame-Options, or X-Content-Type-Options). While this does not constitute an exploitable vulnerability on its own, missing headers can reduce browser-level protections against clickjacking, XSS, and MIME-type attacks.\",\n            \"impact\": \"Reduced defense-in-depth against client-side attacks.\"\n        }\n    }\n</code></pre> <p>Aquesta base de dades cont\u00e9 explicacions per: - SQL Injection - Cross-Site Scripting - Missing Security Headers - Technology Fingerprinting - Sensitive File Exposure - Access Controlled Resources - I m\u00e9s...</p>"},{"location":"agent/pentest/#sistema-de-classificacio-intelligent","title":"Sistema de Classificaci\u00f3 Intel\u00b7ligent","text":"<p>Un dels problemes dels esc\u00e0ners autom\u00e0tics \u00e9s la generaci\u00f3 de falsos positius. Per exemple, un esc\u00e0ner tradicional podria reportar 133 \"vulnerabilitats\" quan en realitat nom\u00e9s n'hi ha 4-5 de reals.</p>"},{"location":"agent/pentest/#problema-anterior","title":"Problema Anterior","text":"<ul> <li>404 Not Found: Es comptaven com a \"descobertes informatives\"</li> <li>200 OK gen\u00e8ric: P\u00e0gines SPA o errors 404 personalitzats es marcaven com a exposicions</li> <li>Resultat: Informes inflats amb baixa credibilitat</li> </ul>"},{"location":"agent/pentest/#solucio-actual-findingstatus","title":"Soluci\u00f3 Actual: FindingStatus","text":"<p>S'ha implementat un sistema estricte de classificaci\u00f3 mitjan\u00e7ant l'enum <code>FindingStatus</code>:</p> <pre><code>class FindingStatus(Enum):\n    CONFIRMED = \"CONFIRMED\"           # Prova verificada d'explotabilitat\n    ENUMERATED = \"ENUMERATED\"         # Comportament observat sense prova directa\n    ACCESS_CONTROLLED = \"ACCESS_CONTROLLED\"  # 403/401 - Recurs protegit\n    REDIRECTED = \"REDIRECTED\"         # 301/302 - Redirecci\u00f3\n    INFORMATIONAL = \"INFORMATIONAL\"   # Informaci\u00f3 p\u00fablica (robots.txt)\n    NOT_FOUND = \"NOT_FOUND\"          # 404 - No existeix\n    NOT_EXPOSED = \"NOT_EXPOSED\"      # 200 OK per\u00f2 sense contingut sensible\n</code></pre>"},{"location":"agent/pentest/#logica-de-classificacio-_classify_exposure","title":"L\u00f2gica de Classificaci\u00f3 (<code>_classify_exposure</code>)","text":"<p>El m\u00e8tode <code>_classify_exposure()</code> \u00e9s el \"cervell\" del scanner. Decideix com tractar cada resposta HTTP:</p> Codi HTTP Context Classificaci\u00f3 Severitat 404 Qualsevol <code>NOT_FOUND</code> \u2192 Appendix N/A 200 HTML gen\u00e8ric <code>NOT_EXPOSED</code> N/A 200 Cont\u00e9 \"password\", \"secret\" <code>CONFIRMED</code> CRITICAL 200 Fitxer binari (.sql, .zip) <code>CONFIRMED</code> HIGH 200 Contingut v\u00e0lid sense proves <code>ENUMERATED</code> MEDIUM 403 / 401 Qualsevol <code>ACCESS_CONTROLLED</code> LOW/INFO 301 / 302 Redirecci\u00f3 a login <code>REDIRECTED</code> INFO"},{"location":"agent/pentest/#resultat-real","title":"Resultat Real","text":"<p>Abans de la millora: <pre><code>Total Findings: 133\n\u251c\u2500 CRITICAL: 45 (falsos positius)\n\u251c\u2500 HIGH: 62 (falsos positius)\n\u2514\u2500 INFO: 26 (404s barrejats)\n</code></pre></p> <p>Despr\u00e9s de la millora: <pre><code>Total Findings: 4\n\u251c\u2500 MEDIUM: 2 (Missing Security Headers, Technology Fingerprinting)\n\u251c\u2500 LOW: 1 (Access Controlled Resource)\n\u2514\u2500 INFO: 1 (Public Information)\n\nAppendix - Enumerated Paths (Not Found): 89 paths\n</code></pre></p>"},{"location":"agent/pentest/#format-pdf-millorat","title":"Format PDF Millorat","text":"<p>Els informes PDF han estat completament redissenyats per millorar la llegibilitat i professionalitat.</p>"},{"location":"agent/pentest/#disseny-de-taula-de-2-files","title":"Disseny de Taula de 2 Files","text":"<p>Problema anterior: Les URLs llargues es truncaven, les explicacions ocupaven massa espai i dificultaven la lectura.</p> <p>Soluci\u00f3 implementada: Cada descoberta ara utilitza 2 files a la taula:</p> <p>Fila 1 (Metadades): | Severity | Status | Type | Evidence | Confidence | |----------|--------|------|----------|------------| | MEDIUM | ENUMERATED | Missing Security Headers | 200 | text/html | CONFIRMED |</p> <p>Fila 2 (Detalls): <pre><code>URL: http://testasixvb.insebre.com/admin/config.php\nDetails: The application response does not include one or more recommended HTTP security headers...\n</code></pre></p> <p>Avantatges: - La URL obt\u00e9 el 100% de l'amplada de la taula - La informaci\u00f3 es pot llegir sense truncar - L'explicaci\u00f3 \u00e9s llegible sense comprimir les altres columnes</p>"},{"location":"agent/pentest/#llegenda-destats","title":"Llegenda d'Estats","text":"<p>Cada informe PDF ara inclou una llegenda d'estats estandarditzada:</p> <p>Definici\u00f3 d'Estats - CONFIRMED: Descoberta d'alta confian\u00e7a amb proves d'explotabilitat - ENUMERATED: Comportament observat sense proves directes d'explotabilitat - ACCESS CONTROLLED: El recurs existeix per\u00f2 est\u00e0 correctament protegit (403 Forbidden) - INFORMATIONAL: Informaci\u00f3 p\u00fablica o esperada sense impacte de seguretat directe</p>"},{"location":"agent/pentest/#avaluacio-general-de-seguretat","title":"Avaluaci\u00f3 General de Seguretat","text":"<p>Al comen\u00e7ament de cada informe PDF, es genera una avaluaci\u00f3 autom\u00e0tica basada en els descobriments:</p> <ul> <li>Sense vulnerabilitats cr\u00edtiques: \"The security posture appears robust based on the scope of this automated scan.\"</li> <li>Amb vulnerabilitats altes: \"The security posture shows signs of significant risk...\"</li> <li>Amb vulnerabilitats cr\u00edtiques: \"The security posture requires IMMEDIATE ATTENTION...\"</li> </ul>"},{"location":"agent/pentest/#appendix-rutes-enumerades","title":"Appendix: Rutes Enumerades","text":"<p>Tots els camins que retornen 404 es llisten en un Appendix separat al final de l'informe:</p> <pre><code>Appendix: Enumerated Paths (Not Found)\n\nThe following paths were probed but returned 404 Not Found.\nThey are listed here for completeness but are NOT considered vulnerabilities.\n\n\u2022 /admin/config.php\n\u2022 /backup.sql\n\u2022 /.env\n\u2022 /phpinfo.php\n...\n</code></pre> <p>Aix\u00f2 mant\u00e9 la transpar\u00e8ncia (l'auditor pot veure qu\u00e8 es va provar) sense inflar el comptador de vulnerabilitats.</p>"},{"location":"agent/pentest/#generacio-unificada-de-pdfs","title":"Generaci\u00f3 Unificada de PDFs","text":"<p>Anteriorment, el codi tenia dues funcions diferents per generar PDFs: - Una per a desc\u00e0rrega directa (<code>pentest_pdf</code>) - Una altra per a Telegram (<code>api_pentest_telegram</code>)</p> <p>Aix\u00f2 causava inconsist\u00e8ncies: els informes podien tenir formats diferents.</p> <p>Soluci\u00f3: S'ha creat la funci\u00f3 <code>generate_pentest_report_pdf()</code> que \u00e9s utilitzada per ambd\u00f3s casos, garantint que: - El PDF descarregat des de la web - El PDF enviat per Telegram</p> <p>...siguin 100% id\u00e8ntics en format, contingut i estil.</p>"},{"location":"agent/pentest/#configuracio-avancada","title":"Configuraci\u00f3 Avan\u00e7ada","text":"<p>Des de la interf\u00edcie del Diag Agent, es poden ajustar els par\u00e0metres de l'escaneig:</p> <ul> <li>Threads: Nombre de fils simultanis (recomanat: 5-10).</li> <li>Max Requests: L\u00edmit total de peticions per evitar bloquejos (per defecte: 500).</li> <li>Profunditat (Depth): Nivell de navegaci\u00f3 recursiva des de la URL llavor.</li> <li>Delay: Temps d'espera entre peticions per evitar detecci\u00f3 WAF/IDS.</li> </ul>"},{"location":"agent/pentest/#resultats-i-evidencies","title":"Resultats i Evid\u00e8ncies","text":"<p>Cada descoberta (Finding) inclou informaci\u00f3 detallada per a la seva mitigaci\u00f3:</p> <ul> <li>Severitat: Critical, High, Medium, Low o Info.</li> <li>Confian\u00e7a: Confirmed, High, Medium o Low.</li> <li>Status: CONFIRMED, ENUMERATED, ACCESS_CONTROLLED, etc.</li> <li>Payload: El codi o cadena exacta utilitzada per disparar la vulnerabilitat.</li> <li>Context: URL afectada i par\u00e0metre vulnerable.</li> <li>Evid\u00e8ncia T\u00e8cnica:</li> <li>HTTP Status Code (200, 403, 302, etc.)</li> <li>Content-Type (application/json, text/html, etc.)</li> <li>Body Fingerprint (json_data, potential_secrets, etc.)</li> <li>Explicaci\u00f3 Professional: Text d'1-2 par\u00e0grafs explicant l'impacte</li> </ul>"},{"location":"agent/pentest/#estadistiques-del-codi","title":"Estad\u00edstiques del Codi","text":"<p>El m\u00f2dul Pentest Agent consta de:</p> <ul> <li>Fitxer principal: <code>pentest_agent.py</code></li> <li>L\u00ednies de codi: ~3.141</li> <li>Classes principals: <code>PentestAgent</code>, <code>GoogleDorker</code>, <code>ExplanationDatabase</code></li> <li>M\u00e8todes d'escaneig: 15+</li> <li>Payloads SQL Injection: 20+ variants</li> <li>Payloads XSS: 15+ vectors</li> <li>Fitxers sensibles: 50+ patterns</li> </ul> <p>\u00das \u00c8tic</p> <p>Recorda que realitzar proves de penetraci\u00f3 sense autoritzaci\u00f3 \u00e9s il\u00b7legal. Utilitza aquest m\u00f2dul nom\u00e9s en entorns controlats o sobre actius dels quals siguis propietari.</p> <p>Impacte de les Millores</p> <p>Les millores implementades durant aquest projecte han transformat el Pentest Agent d'una eina que generava informes inflats i poc professionals a un scanner que produeix informes d'auditoria professional comparables als informes manuals de consultories de ciberseguretat.</p>"},{"location":"agent/requisits/","title":"Requisits del Sistema","text":"<p>Per executar l'eina Diag Agent en un entorn Ubuntu Server, calen els seg\u00fcents components.</p>"},{"location":"agent/requisits/#requisits-de-programari","title":"Requisits de Programari","text":""},{"location":"agent/requisits/#python-i-dependencies","title":"Python i Depend\u00e8ncies","text":"Component Versi\u00f3 M\u00ednima Descripci\u00f3 Python 3.8+ Llenguatge principal de l'aplicaci\u00f3 pip \u00daltima versi\u00f3 Gestor de paquets Python Flask 2.0+ Framework web per la interf\u00edcie psutil 5.8+ Monitoratge de recursos del sistema WeasyPrint 52+ Generaci\u00f3 d'informes PDF"},{"location":"agent/requisits/#eines-externes","title":"Eines Externes","text":"Eina Funci\u00f3 <code>nmap</code> Escaneig de ports i detecci\u00f3 de serveis <code>trivy</code> An\u00e0lisi de vulnerabilitats (CVEs) <code>ssh-audit</code> Auditoria de configuraci\u00f3 SSH <code>enum4linux</code> Enumeraci\u00f3 de serveis SMB/Samba"},{"location":"agent/requisits/#requisits-de-maquinari","title":"Requisits de Maquinari","text":"<p>Especificacions M\u00ednimes</p> <ul> <li>CPU: 2 cores</li> <li>RAM: 2 GB (recomanat 4 GB per escanejos intensius)</li> <li>Disc: 1 GB d'espai lliure per logs i informes</li> <li>Xarxa: Acc\u00e9s a la interf\u00edcie de xarxa del servidor objectiu</li> </ul>"},{"location":"agent/requisits/#installacio-de-dependencies","title":"Instal\u00b7laci\u00f3 de Depend\u00e8ncies","text":"<p>L'script <code>setup_diag.sh</code> automatitza la instal\u00b7laci\u00f3 de totes les depend\u00e8ncies:</p> <pre><code># Assignar permisos d'execuci\u00f3\nchmod +x setup_diag.sh diag_agent_single.py\n\n# Executar l'script d'instal\u00b7laci\u00f3\nsudo ./setup_diag.sh\n</code></pre> <p>Aquest script:</p> <ol> <li>Instal\u00b7la Python3 i pip si no estan presents</li> <li>Instal\u00b7la les eines externes (nmap, trivy, ssh-audit, enum4linux)</li> <li>Instal\u00b7la les llibreries Python necess\u00e0ries</li> <li>Crea el servei systemd <code>diag-agent.service</code></li> </ol>"},{"location":"agent/scrum/","title":"Metodologia SCRUM","text":"<p>Per desenvolupar aquest projecte s'ha aplicat la metodologia SCRUM, una de les m\u00e9s utilitzades actualment en el camp de la inform\u00e0tica i especialment en equips de desenvolupament i gesti\u00f3 de projectes \u00e0gils. Tot i que Cybershield Solutions, S.L. \u00e9s una empresa petita i actualment est\u00e0 formada per un \u00fanic membre, s'ha simulat un entorn de treball col\u00b7laboratiu per aplicar correctament els principis de SCRUM i entendre com funcionaria dins d'una estructura real d'equip.</p>"},{"location":"agent/scrum/#rols-de-lequip","title":"Rols de l'equip","text":"<p>Tot i ser un projecte unipersonal, s'han assignat els diferents rols propis de SCRUM per tal d'organitzar el treball i mantenir una visi\u00f3 clara de cada responsabilitat:</p> Rol Responsable Descripci\u00f3 Product Owner Vitaliy Domin Responsable de definir els objectius del projecte, establir les prioritats i assegurar que les funcionalitats desenvolupades responguin a les necessitats del client. Scrum Master Vitaliy Domin Encarregat de garantir que el flux de treball es mantingui estable, eliminar bloquejos i assegurar el compliment de la metodologia \u00e0gil. Development Team Vitaliy Domin Responsable del disseny, programaci\u00f3 i posada en marxa de l'aplicaci\u00f3 Diag Agent, aix\u00ed com de la configuraci\u00f3 de l'entorn d'auditoria i la documentaci\u00f3 t\u00e8cnica del projecte. <p>Aquesta assignaci\u00f3 m\u00faltiple de rols ha perm\u00e8s comprendre totes les fases d'un projecte SCRUM des de diferents punts de vista, tot adaptant la metodologia a una realitat individual.</p>"},{"location":"agent/scrum/#organitzacio-de-tasques","title":"Organitzaci\u00f3 de tasques","text":"<p>Per gestionar el flux de treball s'ha utilitzat NexusBoard, implementant un tauler amb les cl\u00e0ssiques columnes:</p> <ul> <li>To Do: tasques pendents de comen\u00e7ar (configuraci\u00f3 d'entorn, recerca d'eines, disseny del logo, etc.).</li> <li>In Progress: tasques actualment en desenvolupament (codi Python, proves d'escaneig, documentaci\u00f3).</li> <li>Testing: tasques completades, per\u00f2 en revisi\u00f3 (proves amb Nmap, Trivy i PDF reports).</li> <li>Done: tasques finalitzades i validades.</li> </ul> <p>Aquesta organitzaci\u00f3 ha perm\u00e8s tenir una visi\u00f3 clara de l'estat del projecte en tot moment, evitant acumulaci\u00f3 de tasques i millorant la planificaci\u00f3.</p>"},{"location":"agent/scrum/#estructura-dels-sprints","title":"Estructura dels Sprints","text":"<p>El projecte s'ha dividit en tres Sprints principals:</p> <ol> <li>Sprint 1: Definici\u00f3 de l'empresa, an\u00e0lisi de riscos i contracte simb\u00f2lic.</li> <li>Sprint 2: Disseny i desenvolupament de l'aplicaci\u00f3 Diag Agent (versi\u00f3 funcional).</li> <li>Sprint 3: Elaboraci\u00f3 del pla de millora, creaci\u00f3 de la web i documentaci\u00f3 final.</li> </ol> <p>Cada Sprint ha incl\u00f2s la seva pr\u00f2pia planificaci\u00f3, execuci\u00f3, revisi\u00f3 i retrospectiva, seguint el cicle iteratiu de millora cont\u00ednua propi de SCRUM.</p>"},{"location":"agent/scrum/#reunions-i-seguiment","title":"Reunions i seguiment","text":"<p>Tot i no existir un equip f\u00edsic, s'han realitzat simulacions de Daily Stand-Ups de manera individual, utilitzant anotacions i registres en NexusBoard per revisar l'estat diari de les tasques.</p> <p>A m\u00e9s, al final de cada Sprint s'ha fet una revisi\u00f3 i una retrospectiva, analitzant qu\u00e8 ha funcionat b\u00e9, quins reptes han aparegut i quins aspectes es podrien optimitzar.</p>"},{"location":"agent/soc/","title":"SOC Dashboard","text":"<p>El Centre d'Operacions de Seguretat (SOC) ofereix monitoratge en temps real del sistema.</p>"},{"location":"agent/soc/#visio-general","title":"Visi\u00f3 General","text":"<p>El SOC Dashboard proporciona visibilitat immediata sobre:</p> <ul> <li>Salut del sistema: CPU, mem\u00f2ria, disc</li> <li>Tr\u00e0fic de xarxa: bytes enviats/rebuts per segon</li> <li>Network IDS Shield: Inspecci\u00f3 de paquets en temps real (motor Scapy)</li> <li>Events de seguretat: fallades SSH, processos sospitosos</li> <li>Logs cr\u00edtics: \u00faltims missatges del sistema</li> </ul>"},{"location":"agent/soc/#metriques-en-temps-real","title":"M\u00e8triques en Temps Real","text":""},{"location":"agent/soc/#emmagatzematge-dhistorial","title":"Emmagatzematge d'Historial","text":"<pre><code>from collections import deque\n\n# Store metric history (last 60 data points)\nsoc_history = {\n    \"cpu\": deque(maxlen=60),\n    \"memory\": deque(maxlen=60),\n    \"disk\": deque(maxlen=60),\n    \"network_sent\": deque(maxlen=60),\n    \"network_recv\": deque(maxlen=60),\n    \"timestamps\": deque(maxlen=60)\n}\n\n# Track previous network counters for rate calculation\nsoc_prev_net = {\n    \"bytes_sent\": 0, \n    \"bytes_recv\": 0, \n    \"timestamp\": time.time()\n}\n</code></pre>"},{"location":"agent/soc/#funcions-de-recolleccio","title":"Funcions de Recol\u00b7lecci\u00f3","text":""},{"location":"agent/soc/#soc_get_system_metrics","title":"<code>soc_get_system_metrics()</code>","text":"<p>Recull m\u00e8triques de salut del sistema amb llindars d'alerta.</p> <pre><code>def soc_get_system_metrics():\n    \"\"\"\n    Returns:\n        {\n            \"cpu_percent\": 45.2,\n            \"cpu_alert\": False,      # True si &gt; 80%\n            \"memory_percent\": 62.1,\n            \"memory_alert\": False,   # True si &gt; 90%\n            \"disk_percent\": 55.0,\n            \"disk_alert\": False,     # True si &gt; 85%\n            \"uptime_seconds\": 123456,\n            \"uptime_human\": \"1d 10h 17m\"\n        }\n    \"\"\"\n</code></pre>"},{"location":"agent/soc/#soc_get_network_metrics","title":"<code>soc_get_network_metrics()</code>","text":"<p>Recull estad\u00edstiques de xarxa i connexions actives.</p> <pre><code>def soc_get_network_metrics():\n    \"\"\"\n    Returns:\n        {\n            \"bytes_sent_rate\": 1234,    # bytes/sec\n            \"bytes_recv_rate\": 5678,    # bytes/sec\n            \"active_connections\": 42,\n            \"established\": 30,\n            \"listening\": 12\n        }\n    \"\"\"\n</code></pre>"},{"location":"agent/soc/#soc_get_security_events","title":"<code>soc_get_security_events()</code>","text":"<p>Detecta events de seguretat i processos sospitosos.</p> <pre><code>def soc_get_security_events():\n    \"\"\"\n    Returns:\n        {\n            \"ssh_failed_attempts\": 15,\n            ...\n        }\n    \"\"\"\n</code></pre>"},{"location":"agent/soc/#network-ids-shield-scapy-engine","title":"Network IDS Shield (Scapy Engine)","text":"<p>El Diag Agent inclou un motor d'inspecci\u00f3 de xarxa en temps real (IDS) basat en la llibreria Scapy. A difer\u00e8ncia de les m\u00e8triques est\u00e0ndard que llegeixen del sistema operatiu, el Shield IDS realitza una Inspecci\u00f3 de Paquets (DPI) per detectar anomalies mentre ocorren.</p>"},{"location":"agent/soc/#arquitectura-del-monitor","title":"Arquitectura del Monitor","text":"<p>El monitor corre en un fil secundari (<code>daemon thread</code>) per no bloquejar el servidor Flask:</p> <pre><code>class NetworkMonitor:\n    def _run_sniffer(self):\n        # Captura paquets de forma as\u00edncrona\n        sniff(prn=self._packet_callback, store=0)\n\n    def _packet_callback(self, pkt):\n        # Cervell de detecci\u00f3: ports, taxes, volums\n        self._check_triggers(pkt)\n</code></pre>"},{"location":"agent/soc/#triggers-de-seguretat","title":"Triggers de Seguretat","text":"Trigger L\u00f2gica de Detecci\u00f3 Gravetat Dangerous Ports Intent de connexi\u00f3 als ports 21, 23, 445, 3389 ALTA Brute Force M\u00e9s de 20 paquets per segon des de la mateixa IP CR\u00cdTICA Data Exfiltration Transfer\u00e8ncia de m\u00e9s de 10MB cap a un dest\u00ed extern ALTA"},{"location":"agent/soc/#visualitzacio-del-dashboard","title":"Visualitzaci\u00f3 del Dashboard","text":"<ol> <li>Live Packet Feed: Taula actualitzada cada 3 segons amb el resum de cada paquet (Protocol, Font, Dest\u00ed, Port).</li> <li>Top Talkers: Gr\u00e0fic de barres din\u00e0mic que identifica les adreces IP amb m\u00e9s c\u00e0rrega de tr\u00e0nsit.</li> <li>Advanced Traffic Analytics: Llista granular d'IPs \u00daniques separades per protocols (TCP vs UDP). Permet identificar r\u00e0pidament actors que nom\u00e9s realitzen tr\u00e0nsit UDP \"estrany\".</li> <li>AI SOC Assistant: Motor d'an\u00e0lisi heur\u00edstica que classifica els events en categories ({Port Scan, Brute Force, DoS, etc.}) i genera un resum d'analista amb evid\u00e8ncies i accions recomanades.</li> <li>Control Status: Bot\u00f3 interactiu per activar/desactivar el blindatge de xarxa a demanda.</li> </ol> <p>[!TIP] L'IDS filtra autom\u00e0ticament el tr\u00e0nsit propi de la m\u00e0quina (self-traffic filtering) per evitar que les teves pr\u00f2pies auditories apareguin com a atacs al dashboard.</p> <p>[!IMPORTANT] Aquest m\u00f2dul requereix que l'agent s'executi com a root (o amb capabilities de <code>CAP_NET_RAW</code>) per poder obrir sockets de baix nivell i interceptar el tr\u00e0nsit de la interf\u00edcie.</p>"},{"location":"agent/soc/#deteccio-de-processos-sospitosos","title":"Detecci\u00f3 de Processos Sospitosos","text":"<p>El sistema utilitza heur\u00edstiques per identificar processos potencialment maliciosos:</p>"},{"location":"agent/soc/#criteris-de-deteccio","title":"Criteris de Detecci\u00f3","text":"Criteri Descripci\u00f3 Exemple Ruta no est\u00e0ndard Executable fora de /usr, /bin, /sbin <code>/home/user/.hidden/malware</code> Patrons sospitosos .tmp, .sh, .py a nom d'executable <code>payload.tmp.sh</code> Noms ocults Fitxers que comencen amb <code>.</code> <code>/.secret_miner</code> Root des d'usuari Proc\u00e9s root des de /home o /tmp <code>sudo /tmp/exploit</code> Port no est\u00e0ndard Proc\u00e9s escoltant en ports inusuals <code>nc -l 4444</code>"},{"location":"agent/soc/#implementacio","title":"Implementaci\u00f3","text":"<pre><code>def collect_suspicious_processes(limit=200):\n    \"\"\"\n    Heuristics:\n      - Executable path not under standard system paths\n      - Executable contains .tmp, .sh, .py, /tmp/, hidden names\n      - Running as root from user dirs (/home, /tmp)\n      - Listening network processes not from standard paths\n    \"\"\"\n    suspicious = []\n\n    # Whitelist de rutes del sistema\n    SYSTEM_PATHS = [\n        \"/usr/\", \"/bin/\", \"/sbin/\", \"/lib/\",\n        \"/opt/\", \"/snap/\", \"/var/lib/\"\n    ]\n\n    for proc in psutil.process_iter(['pid', 'name', 'exe', 'cmdline', 'username']):\n        exe = proc.info['exe'] or \"\"\n\n        # Check if outside system paths\n        if exe and not any(exe.startswith(p) for p in SYSTEM_PATHS):\n            suspicious.append({\n                \"pid\": proc.info['pid'],\n                \"name\": proc.info['name'],\n                \"exe\": exe,\n                \"reason\": \"Non-standard path\"\n            })\n\n    return suspicious[:limit]\n</code></pre>"},{"location":"agent/soc/#grafiques-en-temps-real","title":"Gr\u00e0fiques en Temps Real","text":"<p>El frontend utilitza Chart.js per renderitzar gr\u00e0fiques interactives:</p> <pre><code>// Exemple de configuraci\u00f3 Chart.js\nconst cpuChart = new Chart(ctx, {\n    type: 'line',\n    data: {\n        labels: timestamps,\n        datasets: [{\n            label: 'CPU %',\n            data: cpuData,\n            borderColor: 'rgb(59, 130, 246)',\n            fill: true,\n            backgroundColor: 'rgba(59, 130, 246, 0.1)'\n        }]\n    },\n    options: {\n        responsive: true,\n        scales: { y: { min: 0, max: 100 } }\n    }\n});\n</code></pre>"},{"location":"agent/soc/#tipus-de-grafiques","title":"Tipus de Gr\u00e0fiques","text":"M\u00e8trica Tipus Actualitzaci\u00f3 CPU L\u00ednia Cada 2s Mem\u00f2ria L\u00ednia Cada 2s Disc Gauge Cada 10s Xarxa TX \u00c0rea Cada 2s Xarxa RX \u00c0rea Cada 2s"},{"location":"agent/soc/#sistema-dalertes","title":"Sistema d'Alertes","text":""},{"location":"agent/soc/#llindars-configurats","title":"Llindars Configurats","text":"<pre><code>THRESHOLDS = {\n    \"cpu_warning\": 70,\n    \"cpu_critical\": 90,\n    \"memory_warning\": 80,\n    \"memory_critical\": 95,\n    \"disk_warning\": 80,\n    \"disk_critical\": 90,\n    \"ssh_fails_warning\": 10,\n    \"ssh_fails_critical\": 50\n}\n</code></pre>"},{"location":"agent/soc/#logs-critics","title":"Logs Cr\u00edtics","text":"<pre><code>def soc_get_critical_logs(lines=15):\n    \"\"\"\n    Get critical system logs with clean formatting.\n\n    Sources:\n        - /var/log/syslog\n        - /var/log/auth.log\n        - journalctl -p err\n\n    Returns:\n        [\n            {\n                \"timestamp\": \"2025-01-15 10:30:45\",\n                \"level\": \"ERROR\",\n                \"source\": \"sshd\",\n                \"message\": \"Failed password for invalid user admin\"\n            },\n            ...\n        ]\n    \"\"\"\n</code></pre> <p>Futures Millores</p> <ul> <li>Alertes per email/Telegram</li> <li>Hist\u00f2ric persistent amb SQLite</li> <li>Dashboard multi-host</li> <li>Integraci\u00f3 amb Grafana</li> </ul>"},{"location":"agent/valoracio/","title":"Valoraci\u00f3 del Risc","text":"<p>Cada risc s'ha avaluat segons dos criteris principals:</p> <ul> <li>Impacte: conseq\u00fc\u00e8ncies que tindria per a la disponibilitat, integritat o confidencialitat del sistema.</li> <li>Probabilitat: possibilitat que el risc es materialitzi.</li> </ul> <p>La combinaci\u00f3 d'aquests factors genera un nivell de risc (Baix, Mitj\u00e0 o Alt).</p>"},{"location":"agent/valoracio/#taula-de-valoracio-de-riscos","title":"Taula de Valoraci\u00f3 de Riscos","text":"N\u00fam. Risc identificat Impacte Probabilitat Nivell global Mesura preventiva 1 Vulnerabilitats en paquets obsolets d'Ubuntu Alt Mitj\u00e0 Alt Actualitzacions peri\u00f2diques autom\u00e0tiques i an\u00e0lisi amb Trivy. 2 Acc\u00e9s no autoritzat per SSH Alt Baix Mitj\u00e0 Limitaci\u00f3 per IP i claus SSH, monitoratge de logs. 3 Configuraci\u00f3 insegura d'Apache o Nginx Mitj\u00e0 Mitj\u00e0 Mitj\u00e0 Revisi\u00f3 de permisos, seguretat TLS i scripts Nmap vuln. 4 Error hum\u00e0 en la gesti\u00f3 d'usuaris Mitj\u00e0 Alt Alt Pol\u00edtiques de rotaci\u00f3 de contrasenyes i auditories internes. 5 Fallada del sistema HA (replicaci\u00f3) Alt Baix Mitj\u00e0 Monitoratge i proves peri\u00f2diques de failover. 6 Abs\u00e8ncia de c\u00f2pies de seguretat fiables Alt Mitj\u00e0 Alt Implementar c\u00f2pies di\u00e0ries i validaci\u00f3 de restauracions."},{"location":"agent/valoracio/#conclusions-de-lanalisi","title":"Conclusions de l'an\u00e0lisi","text":"<p>L'avaluaci\u00f3 dels riscos ha posat en relleu que els principals punts cr\u00edtics de la infraestructura s\u00f3n:</p> <p>Punts Cr\u00edtics</p> <ul> <li>La depend\u00e8ncia de la disponibilitat dels servidors (entorn HA).</li> <li>La necessitat d'una pol\u00edtica d'actualitzacions i c\u00f2pies de seguretat m\u00e9s estricta.</li> <li>La import\u00e0ncia de monitorar accessos i processos sospitosos de manera cont\u00ednua.</li> </ul>"},{"location":"agent/valoracio/#mesures-proposades","title":"Mesures Proposades","text":"<p>Com a resposta, Cybershield Solutions, S.L. proposa aplicar un conjunt de mesures de millora incloses en el pla de seguretat, entre les quals destaquen:</p> <ol> <li>L'automatitzaci\u00f3 d'auditories peri\u00f2diques mitjan\u00e7ant l'eina Diag Agent.</li> <li>La implementaci\u00f3 de scripts de supervisi\u00f3 constants per a serveis cr\u00edtics.</li> <li>L'establiment de pol\u00edtiques de backup automatitzades amb verificaci\u00f3.</li> </ol>"},{"location":"agent/conclusions/","title":"Conclusions i Futures Millores","text":""},{"location":"agent/conclusions/#conclusions","title":"Conclusions","text":"<p>El projecte ha demostrat la viabilitat de crear una eina d'auditoria personalitzada i \u00e0gil utilitzant programari de codi obert. La implementaci\u00f3 del SOC Dashboard ha estat un valor afegit clau, permetent no nom\u00e9s l'auditoria \"post-mortem\" sin\u00f3 el monitoratge preventiu.</p>"},{"location":"agent/conclusions/#objectius-assolits","title":"Objectius Assolits","text":"Objectiu Estat Desenvolupament d'eina d'auditoria automatitzada \u2705 Completat Integraci\u00f3 de m\u00faltiples eines de seguretat \u2705 Completat Generaci\u00f3 d'informes PDF professionals \u2705 Completat Dashboard de monitoratge en temps real \u2705 Completat Signatura digital d'informes \u2705 Completat"},{"location":"agent/conclusions/#punts-forts","title":"Punts Forts","text":"<p>\u00c8xits del Projecte</p> <ul> <li>Modularitat: L'arquitectura permet afegir nous m\u00f2duls f\u00e0cilment</li> <li>Portabilitat: Un \u00fanic fitxer Python facilita el desplegament</li> <li>Professionalitat: Informes amb qualitat empresarial</li> <li>Seguretat: Validaci\u00f3 d'entrades i sanititzaci\u00f3 de comandes</li> </ul>"},{"location":"agent/conclusions/#futures-millores","title":"Futures Millores","text":"<p>Com a l\u00ednies de futur per a Cybershield Solutions, es proposa:</p>"},{"location":"agent/conclusions/#curt-termini","title":"Curt Termini","text":"<ol> <li>Autenticaci\u00f3 d'Usuaris: Afegir sistema de login per protegir l'acc\u00e9s al tauler de control</li> <li>Alertes en Temps Real: Implementar notificacions per correu electr\u00f2nic o Telegram quan es detecti un atac de for\u00e7a bruta</li> </ol>"},{"location":"agent/conclusions/#mitja-termini","title":"Mitj\u00e0 Termini","text":"<ol> <li>Base de Dades Persistent: Crear una base de dades SQLite per guardar l'hist\u00f2ric d'auditories i comparar l'evoluci\u00f3 de la seguretat en el temps</li> <li>API P\u00fablica: Documentar i exposar una API REST completa per integraci\u00f3 amb altres eines</li> </ol>"},{"location":"agent/conclusions/#llarg-termini","title":"Llarg Termini","text":"<ol> <li>Suport Multi-Plataforma: Ampliar compatibilitat a altres distribucions Linux (CentOS, Debian)</li> <li>Mode Cl\u00faster: Permetre monitorar m\u00faltiples servidors des d'una \u00fanica consola</li> <li>Machine Learning: Incorporar detecci\u00f3 d'anomalies basada en IA</li> </ol> <p>Contribucions</p> <p>El projecte est\u00e0 obert a col\u00b7laboracions. Contacteu amb Cybershield Solutions per proposar millores o reportar errors.</p>"},{"location":"agent/manual/","title":"Manual d'Usuari","text":""},{"location":"agent/manual/#introduccio","title":"Introducci\u00f3","text":"<p>Diag Agent \u00e9s una eina d'auditoria de seguretat desenvolupada per Cybershield Solutions, S.L. que permet realitzar an\u00e0lisis complets de sistemes Linux Ubuntu Server.</p>"},{"location":"agent/manual/#acces-a-laplicacio","title":"Acc\u00e9s a l'Aplicaci\u00f3","text":"<p>Un cop el servei est\u00e0 en funcionament, accediu a la interf\u00edcie web:</p> <pre><code>http://&lt;IP_DEL_SERVIDOR&gt;:8080\n</code></pre>"},{"location":"agent/manual/#pestanyes-principals","title":"Pestanyes Principals","text":""},{"location":"agent/manual/#dashboard","title":"Dashboard","text":"<p>La pestanya principal mostra un resum de l'estat del sistema amb targetes clares per a:</p> <ul> <li>Vulnerabilitats: Nombre de CVEs detectats</li> <li>Paquets: Paquets actualitzables</li> <li>SSH Fails: Intents d'acc\u00e9s SSH fallits</li> <li>CPU/Mem\u00f2ria/Disc: \u00das de recursos del sistema</li> </ul>"},{"location":"agent/manual/#vulns-vulnerabilitats","title":"Vulns (Vulnerabilitats)","text":"<p>An\u00e0lisi de vulnerabilitats utilitzant Trivy:</p> <ul> <li>Escaneig del sistema de fitxers (<code>rootfs</code>)</li> <li>Detecci\u00f3 de CVEs cr\u00edtics i d'alta prioritat</li> <li>Optimitzat per ometre directoris temporals (<code>/tmp</code>, <code>/var/cache</code>)</li> </ul>"},{"location":"agent/manual/#nmap","title":"Nmap","text":"<p>Escaneig de xarxa amb validaci\u00f3 de seguretat:</p> <ul> <li>Escaneig de ports TCP</li> <li>Detecci\u00f3 de serveis i versions</li> <li>Flags permesos: <code>-sV</code>, <code>-Pn</code>, <code>-T4</code></li> </ul>"},{"location":"agent/manual/#services","title":"Services","text":"<p>Llistat de serveis del sistema i el seu estat actual.</p>"},{"location":"agent/manual/#logs","title":"Logs","text":"<p>An\u00e0lisi dels registres del sistema per detectar anomalies.</p>"},{"location":"agent/manual/#ssh-logs","title":"SSH Logs","text":"<p>Monitoratge espec\u00edfic d'accessos SSH i intents de for\u00e7a bruta.</p>"},{"location":"agent/manual/#generacio-dinformes","title":"Generaci\u00f3 d'Informes","text":"<p>La pestanya Report permet:</p>"},{"location":"agent/manual/#seleccio-modular","title":"Selecci\u00f3 Modular","text":"<p>L'usuari pot triar quines seccions incloure a l'informe:</p> <ul> <li> Vulnerabilitats (Trivy)</li> <li> Escaneig de xarxa (Nmap)</li> <li> Logs del sistema</li> <li> Accessos SSH</li> <li> Processos sospitosos</li> <li> Serveis</li> <li> Paquets actualitzables</li> </ul>"},{"location":"agent/manual/#formats-dexportacio","title":"Formats d'Exportaci\u00f3","text":"Format Descripci\u00f3 PDF Document professional amb marca d'aigua de Cybershield Solutions, taula de resum executiu i detalls t\u00e8cnics CSV Dades en brut per a tractament posterior en fulls de c\u00e0lcul <p>Consell</p> <p>Per a informes executius, seleccioneu nom\u00e9s les seccions de Vulnerabilitats i Resum. Per a informes t\u00e8cnics complets, seleccioneu totes les seccions.</p>"},{"location":"agent/manual/#desinstallacio","title":"Desinstal\u00b7laci\u00f3","text":"<p>Per eliminar completament el Diag Agent del sistema, s'ha proporcionat un script de desinstal\u00b7laci\u00f3 que neteja tots els components.</p>"},{"location":"agent/manual/#execucio","title":"Execuci\u00f3","text":"<pre><code># Des del directori del Diag Agent\nsudo ./uninstall_diag.sh\n</code></pre>"},{"location":"agent/manual/#components-eliminats","title":"Components Eliminats","text":"<p>L'script elimina els seg\u00fcents components:</p> Component Descripci\u00f3 Servei systemd <code>diag-agent.service</code> - Atura i elimina el servei Entorn virtual <code>venv/</code> - Tot el Python virtualenv amb les depend\u00e8ncies enum4linux-ng Directori clonat de GitHub Certificats <code>certs/</code> - Claus privades i certificats generats Paquets APT Opcional - <code>ssh-audit</code> i altres eines Fitxers Python Opcional - <code>diag_agent_single.py</code>, <code>pentest_agent.py</code>, etc."},{"location":"agent/manual/#modes-de-desinstallacio","title":"Modes de Desinstal\u00b7laci\u00f3","text":"<p>L'script ofereix diferents nivells de neteja:</p> <ol> <li> <p>Desinstal\u00b7laci\u00f3 Parcial: Elimina servei, venv, i components del sistema per\u00f2 conserva els fitxers Python (permet reinstal\u00b7lar f\u00e0cilment)</p> </li> <li> <p>Desinstal\u00b7laci\u00f3 Completa: Elimina absolutament tot, incloent els fitxers Python i l'script mateix</p> </li> </ol> <p>Atenci\u00f3</p> <p>La desinstal\u00b7laci\u00f3 completa \u00e9s irreversible. Assegureu-vos de tenir una c\u00f2pia de seguretat dels fitxers si cal.</p>"},{"location":"agent/manual/#confirmacio-de-seguretat","title":"Confirmaci\u00f3 de Seguretat","text":"<p>Per evitar eliminacions accidentals, l'script requereix confirmaci\u00f3 expl\u00edcita:</p> <pre><code>Est\u00e0s segur que vols continuar? (escriu 'SI' per confirmar): SI\n</code></pre>"},{"location":"agent/manual/#que-no-selimina","title":"Qu\u00e8 NO s'elimina","text":"<p>Per seguretat, l'script NO elimina:</p> <ul> <li>Paquets essencials del sistema (<code>python3</code>, <code>curl</code>, <code>git</code>, etc.)</li> <li>Eines comunes que poden ser usades per altres aplicacions (<code>nmap</code>, <code>smbclient</code>)</li> <li>Configuracions del sistema no relacionades amb Diag Agent</li> </ul>"},{"location":"agent/signatura/","title":"Signatura Digital","text":""},{"location":"agent/signatura/#introduccio","title":"Introducci\u00f3","text":"<p>Per tal de verificar l'autenticitat dels informes PDF generats i assegurar que no s'han modificat, Diag Agent incorpora un sistema de signatura digital professional.</p>"},{"location":"agent/signatura/#funcionament","title":"Funcionament","text":"<p>Quan es genera un informe PDF, l'aplicaci\u00f3 segueix el seg\u00fcent proc\u00e9s:</p> <ol> <li>Generaci\u00f3 del PDF: Crea el document amb WeasyPrint incloent totes les seccions seleccionades</li> <li>C\u00e0lcul del hash: Calcula el hash SHA-256 del document</li> <li>Signatura criptogr\u00e0fica: Aplica la signatura digital utilitzant el certificat de Cybershield Solutions</li> <li>Marca visual: Afegeix una marca visible a la part inferior del document</li> </ol>"},{"location":"agent/signatura/#exemple-de-signatura","title":"Exemple de Signatura","text":"<p>A continuaci\u00f3 es mostra com apareix la signatura digital en un informe PDF generat:</p> <p></p>"},{"location":"agent/signatura/#garanties-de-la-signatura","title":"Garanties de la Signatura","text":"<p>La signatura digital proporciona tres garanties fonamentals:</p> Garantia Descripci\u00f3 Integritat Confirma que el document no ha estat modificat des de la seva creaci\u00f3 Autenticitat Verifica que l'informe ha estat generat per Cybershield Solutions No repudi L'emissor no pot negar haver generat l'informe"},{"location":"agent/signatura/#certificat-digital","title":"Certificat Digital","text":"<p>El certificat s'autogenera durant la instal\u00b7laci\u00f3 amb la seg\u00fcent configuraci\u00f3:</p> <pre><code># Generat per setup_diag.sh\nopenssl req -new -x509 \\\n    -key \"${CERT_DIR}/cybershield.key\" \\\n    -out \"${CERT_DIR}/cybershield.crt\" \\\n    -days 3650 \\\n    -subj \"/C=ES/ST=Barcelona/L=Barcelona/O=Cybershield Solutions/OU=Security Audit Division/CN=Cybershield Solutions/emailAddress=security@cybershield.solutions\"\n</code></pre>"},{"location":"agent/signatura/#fitxers-generats","title":"Fitxers Generats","text":"Fitxer Ubicaci\u00f3 Descripci\u00f3 <code>cybershield.key</code> <code>certs/</code> Clau privada RSA 2048 bits (permisos 600) <code>cybershield.crt</code> <code>certs/</code> Certificat X.509 auto-signat (10 anys)"},{"location":"agent/signatura/#implementacio-tecnica","title":"Implementaci\u00f3 T\u00e8cnica","text":"<p>La signatura s'implementa amb PyHanko, una llibreria Python per a signatures PDF conformes amb est\u00e0ndards:</p> <pre><code>def sign_pdf_report(pdf_bytes):\n    \"\"\"\n    Digitally sign a PDF report using pyhanko.\n    Returns signed PDF bytes or original if signing fails.\n    \"\"\"\n    from pyhanko.sign import signers\n    from pyhanko.pdf_utils.incremental_writer import IncrementalPdfFileWriter\n    from pyhanko.sign.general import load_cert_from_pemder\n    from pyhanko.sign.fields import SigFieldSpec\n\n    # Carregar certificat i clau\n    cert = load_cert_from_pemder(CERT_PATH)\n    key = load_private_key_from_pemder(KEY_PATH)\n\n    # Crear signador\n    signer = signers.SimpleSigner.load(\n        key_file=KEY_PATH,\n        cert_file=CERT_PATH\n    )\n\n    # Aplicar signatura visible\n    pdf_signer = signers.PdfSigner(\n        signature_meta=signers.PdfSignatureMetadata(\n            field_name='CybershieldSignature',\n            reason='Security Audit Report',\n            location='Tortosa, Spain'\n        ),\n        signer=signer,\n        stamp_style=stamp_style  # Marca visual\n    )\n\n    return pdf_signer.sign_pdf(pdf_bytes)\n</code></pre>"},{"location":"agent/signatura/#verificacio-de-la-signatura","title":"Verificaci\u00f3 de la Signatura","text":""},{"location":"agent/signatura/#amb-adobe-acrobat-reader","title":"Amb Adobe Acrobat Reader","text":"<ol> <li>Obrir el PDF signat</li> <li>Fer clic al panell de signatures (esquerra)</li> <li>Clic dret sobre la signatura \u2192 \"Validar signatura\"</li> </ol>"},{"location":"agent/signatura/#amb-eines-de-linia-de-comandes","title":"Amb eines de l\u00ednia de comandes","text":"<pre><code># Verificar amb pdfsig (poppler-utils)\npdfsig -v informe_signat.pdf\n\n# Output esperat:\n# Signature #1:\n#   - Signed by: Cybershield Solutions\n#   - Signing Time: 2025-01-15 10:30:00\n#   - Signature Validation: Signature is Valid\n</code></pre>"},{"location":"agent/signatura/#validacio-online","title":"Validaci\u00f3 Online","text":"<p>Es pot verificar la signatura a:</p> <ul> <li>Signaturit</li> <li>Adobe Acrobat Online</li> </ul>"},{"location":"agent/signatura/#estandards-complets","title":"Est\u00e0ndards Complets","text":"<p>La implementaci\u00f3 compleix amb:</p> <ul> <li>PAdES (PDF Advanced Electronic Signatures)</li> <li>ISO 32000-2 (PDF 2.0)</li> <li>ETSI EN 319 142 (Baseline signatures)</li> </ul> <p>Certificats de Producci\u00f3</p> <p>Per a entorns de producci\u00f3, es recomana utilitzar un certificat em\u00e8s per una Autoritat de Certificaci\u00f3 (CA) reconeguda en lloc del certificat auto-signat.</p>"},{"location":"agent/website/","title":"Website Corporativa","text":"<p>La p\u00e0gina web de Cybershield Solutions serveix com a portal d'informaci\u00f3 i presentaci\u00f3 dels serveis de l'empresa. S'ha dissenyat amb un enfocament modern i professional per transmetre confian\u00e7a i professionalitat als clients potencials.</p>"},{"location":"agent/website/#tecnologies-utilitzades","title":"Tecnologies Utilitzades","text":"Tecnologia Versi\u00f3 \u00das HTML5 5 Estructura sem\u00e0ntica del contingut CSS3 3 Estils, animacions i disseny responsiu JavaScript ES6+ Interactivitat i efectes din\u00e0mics Bootstrap 5.3.2 Framework CSS per a components i grid Bootstrap Icons 1.11.3 Biblioteca d'icones Google Fonts - Tipografia Inter per a text"},{"location":"agent/website/#estructura-dels-fitxers","title":"Estructura dels Fitxers","text":"<pre><code>Website/\n\u251c\u2500\u2500 index.html          # P\u00e0gina principal (1280 l\u00ednies)\n\u251c\u2500\u2500 custom.css          # Estils personalitzats (1405 l\u00ednies)\n\u251c\u2500\u2500 custom.js           # Scripts d'interactivitat\n\u251c\u2500\u2500 carousel.css        # Estils del carrusel de captures\n\u2514\u2500\u2500 Assets/\n    \u251c\u2500\u2500 logo.png        # Logo de Cybershield\n    \u251c\u2500\u2500 foto.jpg        # Foto del fundador\n    \u251c\u2500\u2500 shield.png      # Imatge decorativa\n    \u251c\u2500\u2500 web.png         # Preview per a xarxes socials\n    \u2514\u2500\u2500 Fotos Web/      # Captures de pantalla del Diag Agent\n        \u251c\u2500\u2500 1.png       # Dashboard Principal\n        \u251c\u2500\u2500 2.png       # Escaneig de Vulnerabilitats\n        \u251c\u2500\u2500 3.png       # Gesti\u00f3 de Paquets\n        \u251c\u2500\u2500 ...\n        \u2514\u2500\u2500 10.png      # Exportaci\u00f3 Professional\n</code></pre>"},{"location":"agent/website/#seccions-de-la-pagina","title":"Seccions de la P\u00e0gina","text":""},{"location":"agent/website/#1-navegacio-navbar","title":"1. Navegaci\u00f3 (Navbar)","text":"<p>Barra de navegaci\u00f3 fixa amb efecte glassmorphism que inclou:</p> <ul> <li>Logo de Cybershield amb animaci\u00f3 de flotaci\u00f3</li> <li>Enlla\u00e7os a totes les seccions (Serveis, App, Funcionalitats, Equip, Sobre, Tarifes, Contacte, Not\u00edcies, FAQ)</li> <li>Bot\u00f3 de crida a l'acci\u00f3 \"Comen\u00e7a ara\"</li> <li>Barra de progr\u00e9s de scroll a la part superior</li> </ul>"},{"location":"agent/website/#2-hero-section","title":"2. Hero Section","text":"<p>Secci\u00f3 principal amb:</p> <ul> <li>T\u00edtol animat: \"Automatitzaci\u00f3 d'auditories i plans de millora\"</li> <li>Descripci\u00f3 del servei amb text destacat</li> <li>Botons d'acci\u00f3: \"Prova el Diag Agent\" i \"Sol\u00b7licita una auditoria\"</li> <li>Indicadors de metodologia: SCRUM, Open-Source, Resultats mesurables</li> <li>Terminal Widget animat que simula comandes del Diag Agent:<ul> <li><code>sudo ./setup_diag.sh</code></li> <li><code>trivy fs / --severity HIGH,CRITICAL</code></li> <li><code>nmap -sV -Pn target</code></li> <li>M\u00e9s comandes amb efecte de m\u00e0quina d'escriure</li> </ul> </li> <li>Logos de tecnologies compatibles: Linux, Ubuntu, Proxmox, Grafana, Docker, Python</li> </ul>"},{"location":"agent/website/#3-serveis","title":"3. Serveis","text":"<p>Quatre targetes amb efecte glass que presenten els serveis:</p> Servei Descripci\u00f3 Auditoria de seguretat An\u00e0lisi de vulnerabilitats, revisi\u00f3 de configuracions i exposici\u00f3 de serveis Hardening &amp; millora SSH, TLS, serveis, permisos i actualitzacions controlades Monitoratge continu Diag Agent en mode servei amb vigil\u00e0ncia de processos, logs i paquets Resposta i formaci\u00f3 Tallers per equips t\u00e8cnics i procediments d'incident response"},{"location":"agent/website/#4-app-diag-agent","title":"4. App / Diag Agent","text":"<p>Presentaci\u00f3 completa de l'eina amb:</p> <ul> <li>Descripci\u00f3: \"Agent d'auditoria i diagn\u00f2stic complet per a sistemes Linux\"</li> <li>Llista de caracter\u00edstiques organitzada en dues columnes:<ul> <li>Dashboard en temps real amb KPI</li> <li>Vista organitzada per pestanyes</li> <li>Export professional PDF/CSV</li> <li>API RESTful segura</li> <li>Seguretat integrada amb sanititzaci\u00f3</li> <li>Desplegament r\u00e0pid amb systemd</li> </ul> </li> <li>Carrusel interactiu amb 10 captures de pantalla de l'aplicaci\u00f3:<ol> <li>Dashboard Principal</li> <li>Escaneig de Vulnerabilitats</li> <li>Gesti\u00f3 de Paquets</li> <li>Monitoratge de Serveis</li> <li>An\u00e0lisi de Logs</li> <li>Logs SSH</li> <li>Escaneig Nmap</li> <li>SSH Audit Professional</li> <li>Generaci\u00f3 d'Informes</li> <li>Exportaci\u00f3 Professional</li> </ol> </li> </ul>"},{"location":"agent/website/#5-funcionalitats-detallades","title":"5. Funcionalitats Detallades","text":"<p>Sis targetes t\u00e8cniques que expliquen cada m\u00f2dul:</p> <ol> <li> <p>Escaneig de Vulnerabilitats (Trivy)</p> <ul> <li>An\u00e0lisi d'imatges Docker/Podman</li> <li>Escaneig de sistema de fitxers</li> <li>Filtrat per severitat</li> <li>Base de dades actualitzada</li> <li>Informes amb descripci\u00f3 i fixes</li> </ul> </li> <li> <p>An\u00e0lisi de Xarxa (Nmap)</p> <ul> <li>Descobriment de hosts i serveis</li> <li>Detecci\u00f3 de versions</li> <li>Identificaci\u00f3 de ports oberts</li> <li>Classificaci\u00f3 de ports perillosos</li> <li>Limitaci\u00f3 de 250k car\u00e0cters</li> </ul> </li> <li> <p>Auditoria SSH</p> <ul> <li>An\u00e0lisi d'algoritmes KEX, Host Key, Encryption, MAC</li> <li>Classificaci\u00f3 per nivell de seguretat</li> <li>Detecci\u00f3 d'algoritmes insegurs</li> <li>Recomanacions de hardening</li> <li>Extracci\u00f3 de fingerprints</li> </ul> </li> <li> <p>Gesti\u00f3 de Paquets</p> <ul> <li>Llistat de paquets instal\u00b7lats</li> <li>Detecci\u00f3 d'actualitzables</li> <li>Informaci\u00f3 de versions</li> <li>Historial d'actualitzacions</li> <li>Integraci\u00f3 apt/dpkg</li> </ul> </li> <li> <p>Monitoratge de Serveis</p> <ul> <li>Llistat de processos</li> <li>Detecci\u00f3 de processos sospitosos</li> <li>Whitelist configurable</li> <li>\u00das de recursos per proc\u00e9s</li> <li>Identificaci\u00f3 de serveis exposats</li> </ul> </li> <li> <p>An\u00e0lisi de Logs</p> <ul> <li>Logs de sistema (syslog, kern.log, auth.log)</li> <li>Detecci\u00f3 de fallades SSH</li> <li>Filtrat temporal i per severitat</li> <li>Patrons de comportament an\u00f2mal</li> <li>Exportaci\u00f3 de logs filtrats</li> </ul> </li> </ol>"},{"location":"agent/website/#6-sistema-dinformes","title":"6. Sistema d'Informes","text":"<p>Targeta destacada amb:</p> <ul> <li>Descripci\u00f3 del sistema de generaci\u00f3 d'informes</li> <li>Formats disponibles: PDF i CSV</li> <li>Seccions seleccionables per a informes personalitzats</li> </ul>"},{"location":"agent/website/#7-api-rest","title":"7. API REST","text":"<p>Documentaci\u00f3 de l'API amb exemples de codi:</p> <pre><code>// Exemple: Obtenir estat del sistema\nfetch('/api/status')\n  .then(r =&gt; r.json())\n  .then(data =&gt; {\n    console.log('Vulnerabilitats:', data.vulns);\n    console.log('CPU:', data.cpu + '%');\n    console.log('Mem\u00f2ria:', data.memory + '%');\n  });\n</code></pre> <p>Endpoints disponibles:</p> <ul> <li><code>GET /api/status</code> - Estat general del sistema</li> <li><code>POST /api/run_trivy_filtered</code> - Executa escaneig Trivy</li> <li><code>POST /api/nmap_scan</code> - Llan\u00e7a escaneig Nmap</li> <li><code>POST /api/run_cmd</code> - Executa comandaments segurs</li> </ul>"},{"location":"agent/website/#8-equip","title":"8. Equip","text":"<p>Presentaci\u00f3 del fundador amb:</p> <ul> <li>Foto professional</li> <li>Nom: Vitaliy Domin</li> <li>Rol: Founder \u00b7 Especialista en Ciberseguretat i Infraestructures IT</li> <li>Descripci\u00f3 personal i lema corporatiu</li> </ul>"},{"location":"agent/website/#9-sobre-cybershield","title":"9. Sobre Cybershield","text":"<p>Secci\u00f3 informativa amb:</p> <ul> <li>Descripci\u00f3 del projecte intermodular</li> <li>Punts clau: Entorns Linux Ubuntu, VLANs, LDAP, informes accionables</li> <li>Imatge corporativa</li> </ul>"},{"location":"agent/website/#10-tarifes","title":"10. Tarifes","text":"<p>Tres plans de servei presentats en targetes:</p> Pla Preu Caracter\u00edstiques Start \u20ac399/auditoria Auditoria puntual (1 servidor), Informe PDF/CSV, Recomanacions b\u00e0siques Pro (Popular) \u20ac699.99/mes Fins 5 servidors, Diag Agent com a servei, Sessions mensuals, Suport 24/7 Enterprise A mida Alta disponibilitat, Integraci\u00f3 SIEM, Procediments IR i formaci\u00f3 <p>Inclou taula comparativa de funcionalitats per pla.</p>"},{"location":"agent/website/#11-contacte","title":"11. Contacte","text":"<p>Formulari de contacte amb:</p> <ul> <li>Camps: Nom, Empresa, Email, Tel\u00e8fon, Missatge</li> <li>Checkbox de pol\u00edtica de privacitat</li> <li>Informaci\u00f3 de contacte: Tortosa (Tarragona), email, xarxes socials</li> </ul>"},{"location":"agent/website/#12-faq","title":"12. FAQ","text":"<p>Acordi\u00f3 amb preguntes freq\u00fcents sobre:</p> <ul> <li>Qu\u00e8 \u00e9s el Diag Agent i com funciona</li> <li>Altres preguntes comunes dels clients</li> </ul>"},{"location":"agent/website/#13-noticies","title":"13. Not\u00edcies","text":"<p>Secci\u00f3 de not\u00edcies i actualitzacions del servei.</p>"},{"location":"agent/website/#14-footer","title":"14. Footer","text":"<p>Peu de p\u00e0gina amb:</p> <ul> <li>Logo i descripci\u00f3 de l'empresa</li> <li>Enlla\u00e7os de navegaci\u00f3</li> <li>Xarxes socials (LinkedIn, GitHub, X)</li> <li>Copyright</li> </ul>"},{"location":"agent/website/#caracteristiques-de-disseny","title":"Caracter\u00edstiques de Disseny","text":""},{"location":"agent/website/#estil-visual","title":"Estil Visual","text":"<ul> <li>Color Scheme: Mode fosc amb accents cian i p\u00farpura</li> <li>Tipografia: Inter per a text, JetBrains Mono per a codi</li> <li>Efectes: Glassmorphism, gradients animats, part\u00edcules de fons</li> <li>Animacions: Reveal on scroll, flotaci\u00f3, glitch en t\u00edtols</li> </ul>"},{"location":"agent/website/#variables-css-principals","title":"Variables CSS Principals","text":"<pre><code>:root {\n  --bg: #070b1a;\n  --panel: #0d1426;\n  --text: #f8fbff;\n  --accent: #60a5fa;\n  --accent-neon: #00d4ff;\n  --accent-purple: #9c27ff;\n}\n</code></pre>"},{"location":"agent/website/#responsivitat","title":"Responsivitat","text":"<p>La p\u00e0gina \u00e9s completament responsive amb breakpoints per a:</p> <ul> <li>Escriptori (&gt;1200px)</li> <li>Tablet (768px - 1200px)</li> <li>M\u00f2bil (&lt;768px)</li> </ul>"},{"location":"agent/website/#interactivitat-javascript","title":"Interactivitat (JavaScript)","text":"<p>El fitxer <code>custom.js</code> implementa:</p> <ol> <li>Cursor personalitzat amb efecte de seguiment</li> <li>Animaci\u00f3 de part\u00edcules al fons</li> <li>Scroll spy per a navegaci\u00f3 activa</li> <li>Terminal widget amb efecte de m\u00e0quina d'escriure</li> <li>Carrusel de captures de pantalla amb controls</li> <li>Reveal animations en fer scroll</li> <li>Barra de progr\u00e9s de scroll</li> <li>Back to top bot\u00f3 flotant</li> <li>Validaci\u00f3 de formulari de contacte</li> </ol>"},{"location":"agent/website/#seo-i-metadades","title":"SEO i Metadades","text":"<pre><code>&lt;meta name=\"description\" content=\"Auditories de seguretat...\"&gt;\n&lt;meta property=\"og:type\" content=\"website\"&gt;\n&lt;meta property=\"og:title\" content=\"Cybershield Solutions\"&gt;\n&lt;meta property=\"og:image\" content=\"/Assets/web.png\"&gt;\n&lt;meta name=\"twitter:card\" content=\"summary_large_image\"&gt;\n</code></pre>"},{"location":"agent/website/#acces","title":"Acc\u00e9s","text":"<p>La web est\u00e0 allotjada a: https://cshield.duckdns.org</p>"}]}